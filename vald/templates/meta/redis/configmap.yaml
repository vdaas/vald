#
# Copyright (C) 2019 Vdaas.org Vald team ( kpango, kou-m, rinx )
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Values.meta.name }}-config
data:
  config.yaml: |
    ---
    version: v0.0.0
    server_config:
      {{- include "vald.servers" .Values.meta.servers | nindent 6}}
    redis_config:
      addrs:
      - redis.default.svc.cluster.local
      db: 0
      dial_timeout: 5s
      idle_check_frequency: 1m
      idle_timeout: 5m
      key_pref: ""
      max_conn_age: 0s
      max_redirects: 3
      max_retries: 0
      max_retry_backoff: 512ms
      min_idle_conns: 0
      min_retry_backoff: 8ms
      password: ""
      pool_size: 10
      pool_timeout: 4s
      read_only: false
      read_timeout: 3s
      write_timeout: 3s
      route_by_latency: false
      route_randomly: true
      tls:
        enabled: false
        cert: /path/to/cert
        key: /path/to/key
        ca: /path/to/ca
      tcp:
        dns:
          cache_enabled: true
          refresh_duration: 1h
          cache_expiration: 24h
        dialer:
          timeout: 5s
          keep_alive: 5m
          dual_stack_enabled: false
        tls:
          enabled: false
          cert: /path/to/cert
          key: /path/to/key
          ca: /path/to/ca
      kv_prefix: ""
      vk_prefix: ""
      prefix_delimiter: ""
