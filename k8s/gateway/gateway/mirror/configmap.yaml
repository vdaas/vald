#
# Copyright (C) 2019-2024 vdaas.org vald team <vald@vdaas.org>
#
# Licensed under the Apache License, Version 2.0 (the "License");
# You may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
apiVersion: v1
kind: ConfigMap
metadata:
  name: vald-mirror-gateway-config
  labels:
    app.kubernetes.io/name: vald
    helm.sh/chart: vald-v1.7.14
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: v1.7.14
    app.kubernetes.io/component: gateway-mirror
data:
  config.yaml: "---\nversion: v0.0.0\ntime_zone: UTC\nlogging:\n  format: raw\n  level: debug\n  logger: glg\nserver_config:\n  servers:\n    - name: grpc\n      host: 0.0.0.0\n      port: 8081\n      grpc:\n        bidirectional_stream_concurrency: 20\n        connection_timeout: \"\"\n        enable_admin: true\n        enable_channelz: true\n        enable_reflection: true\n        header_table_size: 0\n        initial_conn_window_size: 2097152\n        initial_window_size: 1048576\n        interceptors:\n        - RecoverInterceptor\n        keepalive:\n          max_conn_age: \"\"\n          max_conn_age_grace: \"\"\n          max_conn_idle: \"\"\n          min_time: 10m\n          permit_without_stream: false\n          time: 3h\n          timeout: 60s\n        max_concurrent_streams: 0\n        max_header_list_size: 0\n        max_receive_message_size: 0\n        max_send_message_size: 0\n        num_stream_workers: 0\n        read_buffer_size: 0\n        shared_write_buffer: false\n        wait_for_handlers: true\n        write_buffer_size: 0\n      mode: GRPC\n      network: tcp\n      probe_wait_time: 3s\n      restart: true\n      socket_option:\n        ip_recover_destination_addr: false\n        ip_transparent: false\n        reuse_addr: true\n        reuse_port: true\n        tcp_cork: false\n        tcp_defer_accept: false\n        tcp_fast_open: false\n        tcp_no_delay: false\n        tcp_quick_ack: false\n      socket_path: \"\"\n  health_check_servers:\n    - name: liveness\n      host: 0.0.0.0\n      port: 3000\n      http:\n        handler_timeout: \"\"\n        http2:\n          enabled: false\n          handler_limit: 0\n          max_concurrent_streams: 0\n          max_decoder_header_table_size: 4096\n          max_encoder_header_table_size: 4096\n          max_read_frame_size: 0\n          max_upload_buffer_per_connection: 0\n          max_upload_buffer_per_stream: 0\n          permit_prohibited_cipher_suites: true\n        idle_timeout: \"\"\n        read_header_timeout: \"\"\n        read_timeout: \"\"\n        shutdown_duration: 5s\n        write_timeout: \"\"\n      mode: REST\n      network: tcp\n      probe_wait_time: 3s\n      restart: true\n      socket_option:\n        ip_recover_destination_addr: false\n        ip_transparent: false\n        reuse_addr: true\n        reuse_port: true\n        tcp_cork: false\n        tcp_defer_accept: false\n        tcp_fast_open: true\n        tcp_no_delay: true\n        tcp_quick_ack: true\n      socket_path: \"\"\n    - name: readiness\n      host: 0.0.0.0\n      port: 3001\n      http:\n        handler_timeout: \"\"\n        http2:\n          enabled: false\n          handler_limit: 0\n          max_concurrent_streams: 0\n          max_decoder_header_table_size: 4096\n          max_encoder_header_table_size: 4096\n          max_read_frame_size: 0\n          max_upload_buffer_per_connection: 0\n          max_upload_buffer_per_stream: 0\n          permit_prohibited_cipher_suites: true\n        idle_timeout: \"\"\n        read_header_timeout: \"\"\n        read_timeout: \"\"\n        shutdown_duration: 0s\n        write_timeout: \"\"\n      mode: REST\n      network: tcp\n      probe_wait_time: 3s\n      restart: true\n      socket_option:\n        ip_recover_destination_addr: false\n        ip_transparent: false\n        reuse_addr: true\n        reuse_port: true\n        tcp_cork: false\n        tcp_defer_accept: false\n        tcp_fast_open: true\n        tcp_no_delay: true\n        tcp_quick_ack: true\n      socket_path: \"\"\n  metrics_servers:\n    - name: pprof\n      host: 0.0.0.0\n      port: 6060\n      http:\n        handler_timeout: 5s\n        http2:\n          enabled: false\n          handler_limit: 0\n          max_concurrent_streams: 0\n          max_decoder_header_table_size: 4096\n          max_encoder_header_table_size: 4096\n          max_read_frame_size: 0\n          max_upload_buffer_per_connection: 0\n          max_upload_buffer_per_stream: 0\n          permit_prohibited_cipher_suites: true\n        idle_timeout: 2s\n        read_header_timeout: 1s\n        read_timeout: 1s\n        shutdown_duration: 5s\n        write_timeout: 1m\n      mode: REST\n      network: tcp\n      probe_wait_time: 3s\n      restart: true\n      socket_option:\n        ip_recover_destination_addr: false\n        ip_transparent: false\n        reuse_addr: true\n        reuse_port: true\n        tcp_cork: true\n        tcp_defer_accept: false\n        tcp_fast_open: false\n        tcp_no_delay: false\n        tcp_quick_ack: false\n      socket_path: \"\"\n  startup_strategy:\n    - liveness\n    - pprof\n    - grpc\n    - readiness\n  shutdown_strategy:\n    - readiness\n    - grpc\n    - pprof\n    - liveness\n  full_shutdown_duration: 600s\n  tls:\n    ca: /path/to/ca\n    cert: /path/to/cert\n    enabled: false\n    insecure_skip_verify: false\n    key: /path/to/key\nobservability:\n  enabled: false\n  otlp:\n    collector_endpoint: \"\"\n    trace_batch_timeout: \"1s\"\n    trace_export_timeout: \"1m\"\n    trace_max_export_batch_size: 1024\n    trace_max_queue_size: 256\n    metrics_export_interval: \"1s\"\n    metrics_export_timeout: \"1m\"\n    attribute:\n      namespace: \"_MY_POD_NAMESPACE_\"\n      pod_name: \"_MY_POD_NAME_\"\n      node_name: \"_MY_NODE_NAME_\"\n      service_name: \"vald-mirror-gateway\"\n  metrics:\n    enable_cgo: true\n    enable_goroutine: true\n    enable_memory: true\n    enable_version_info: true\n    version_info_labels:\n    - vald_version\n    - server_name\n    - git_commit\n    - build_time\n    - go_version\n    - go_os\n    - go_arch\n    - algorithm_info\n  trace:\n    enabled: false\ngateway:\n  pod_name: _MY_POD_NAME_\n  register_duration: 1s\n  namespace: _MY_POD_NAMESPACE_\n  discovery_duration: 1s\n  colocation: dc1\n  group: \n  net:\n    dialer:\n      dual_stack_enabled: false\n      keepalive: 10m\n      timeout: 30s\n    dns:\n      cache_enabled: true\n      cache_expiration: 24h\n      refresh_duration: 5m\n    socket_option:\n      ip_recover_destination_addr: false\n      ip_transparent: false\n      reuse_addr: true\n      reuse_port: true\n      tcp_cork: false\n      tcp_defer_accept: true\n      tcp_fast_open: true\n      tcp_no_delay: true\n      tcp_quick_ack: true\n    tls:\n      ca: /path/to/ca\n      cert: /path/to/cert\n      enabled: false\n      insecure_skip_verify: false\n      key: /path/to/key\n  client:\n    addrs:\n      - vald-lb-gateway.default.svc.cluster.local:8081\n    health_check_duration: \"1s\"\n    connection_pool:\n      enable_dns_resolver: true\n      enable_rebalance: true\n      old_conn_close_duration: 2m\n      rebalance_duration: 30m\n      size: 3\n    backoff:\n      backoff_factor: 1.1\n      backoff_time_limit: 5s\n      enable_error_log: true\n      initial_duration: 5ms\n      jitter_limit: 100ms\n      maximum_duration: 5s\n      retry_count: 100\n    circuit_breaker:\n      closed_error_rate: 0.7\n      closed_refresh_timeout: 10s\n      half_open_error_rate: 0.5\n      min_samples: 1000\n      open_timeout: 1s\n    call_option:\n      content_subtype: \"\"\n      max_recv_msg_size: 0\n      max_retry_rpc_buffer_size: 0\n      max_send_msg_size: 0\n      wait_for_ready: true\n    dial_option:\n      authority: \"\"\n      backoff_base_delay: 1s\n      backoff_jitter: 0.2\n      backoff_max_delay: 120s\n      backoff_multiplier: 1.6\n      disable_retry: false\n      enable_backoff: false\n      idle_timeout: 1h\n      initial_connection_window_size: 2097152\n      initial_window_size: 1048576\n      insecure: true\n      interceptors: []\n      keepalive:\n        permit_without_stream: false\n        time: \"\"\n        timeout: 30s\n      max_call_attempts: 0\n      max_header_list_size: 0\n      max_msg_size: 0\n      min_connection_timeout: 20s\n      net:\n        dialer:\n          dual_stack_enabled: true\n          keepalive: \"\"\n          timeout: \"\"\n        dns:\n          cache_enabled: true\n          cache_expiration: 1h\n          refresh_duration: 30m\n        socket_option:\n          ip_recover_destination_addr: false\n          ip_transparent: false\n          reuse_addr: true\n          reuse_port: true\n          tcp_cork: false\n          tcp_defer_accept: false\n          tcp_fast_open: false\n          tcp_no_delay: false\n          tcp_quick_ack: false\n        tls:\n          ca: /path/to/ca\n          cert: /path/to/cert\n          enabled: false\n          insecure_skip_verify: false\n          key: /path/to/key\n      read_buffer_size: 0\n      shared_write_buffer: false\n      timeout: \"\"\n      user_agent: Vald-gRPC\n      write_buffer_size: 0\n    tls:\n      ca: /path/to/ca\n      cert: /path/to/cert\n      enabled: false\n      insecure_skip_verify: false\n      key: /path/to/key\n  self_mirror_addr: vald-mirror-gateway.default.svc.cluster.local:8081\n  gateway_addr: vald-lb-gateway.default.svc.cluster.local:8081\n"
