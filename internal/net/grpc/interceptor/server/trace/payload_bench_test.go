package trace

import (
	"encoding/json"
	"testing"
)

// NOTE: generated by https://json-generator.com/
var testJson = `
[
  {
    "_id": "6228304e91ff005521f055a0",
    "index": 0,
    "guid": "32a05fca-9759-41fa-882c-a878f670d3f5",
    "isActive": false,
    "balance": "$1,943.23",
    "picture": "http://placehold.it/32x32",
    "age": 33,
    "eyeColor": "green",
    "name": "Goodman Fitzgerald",
    "gender": "male",
    "company": "ORBIXTAR",
    "email": "goodmanfitzgerald@orbixtar.com",
    "phone": "+1 (808) 547-2333",
    "address": "750 Sunnyside Avenue, Maybell, Vermont, 356",
    "about": "In esse nisi quis nisi cupidatat. Qui esse magna consequat amet mollit adipisicing adipisicing proident. Consequat consequat quis velit non proident. Consequat commodo magna sit do labore. Sunt reprehenderit do id deserunt voluptate velit ullamco.\r\n",
    "registered": "2018-10-17T03:11:06 -09:00",
    "latitude": 4.696977,
    "longitude": -90.128225,
    "tags": [
      "non",
      "voluptate",
      "excepteur",
      "est",
      "tempor",
      "id",
      "nostrud"
    ],
    "friends": [
      {
        "id": 0,
        "name": "Marcy Sheppard"
      },
      {
        "id": 1,
        "name": "Santos Donaldson"
      },
      {
        "id": 2,
        "name": "Shari Orr"
      }
    ],
    "greeting": "Hello, Goodman Fitzgerald! You have 7 unread messages.",
    "favoriteFruit": "banana"
  }
]
`

func Benchmark_marshalJSON(b *testing.B) {
	var obj interface{}
	err := json.Unmarshal([]byte(testJson), &obj)
	if err != nil {
		b.Fatal(err)
	}

	b.ReportAllocs()
	b.ResetTimer()
	b.RunParallel(func(pb *testing.PB) {
		for pb.Next() {
			got := marshalJSON(obj)
			if len(got) == 0 {
				b.Error("marshaled JSON is empty")
			}
		}
	})
}
