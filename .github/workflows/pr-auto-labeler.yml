name: Run PR Auto Labeler
on:
- pull_request

jobs:
  pr-auto-labeler:
    name: pr-auto-labeler
    runs-on: ubuntu-latest
    steps:
    - name: add labels to an PR
      run: |
        add_label() {
          curl --request POST \
               --url https://api.github.com/repos/${{ github.repository }}/issues/${pr_num}/labels \
               --header 'authorization: Bearer ${{ secrets.GITHUB_TOKEN }}' \
               --header 'content-type: application/json' \
               --data "{
                 \"labels\": [\"$1\"]
               }"
        }
        
        pr_num=`cat $GITHUB_EVENT_PATH | jq -r ".number"`
        branch_name=${GITHUB_REF##*/}
        type_labels=(
            "type/test"
            "type/bug"
            "type/documentation"
            "type/feature"
            "type/refactoring"
            "type/security"
            "type/test"
            "type/ci"
            "type/dependency"
        )

        for label in ${type_labels[@]}
        do
          if [ "`echo ${branch_name} | grep ${label##*/}`" ] ; then
            echo $label
            add_label ${label}
          fi
        done

        additions=`cat $GITHUB_EVENT_PATH | jq -r ".pull_request.additions"`
        deletions=`cat $GITHUB_EVENT_PATH | jq -r ".pull_request.deletions"`
        size=`expr ${additions} + ${deletions}`

        if [ $size -le 29 ]; then
          add_label size/S
        elif [ $size -le 99 ]; then
          add_label size/M
        else
          add_label size/L
        fi
