<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-F9Y0YKG55S"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F9Y0YKG55S")</script><link rel=canonical href=https://vald.vdaas.org><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=robots content='index, follow'><title>Vald | Upgrade Cluster</title>
<meta name=description content="Vald is high scalable distributed high-speed approximate nearest neighbor search engine" }><meta name=format-detection content="telephone=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta property="og:type" content="article"><meta property="og:title" content="Vald | Upgrade Cluster"><meta property="og:description" content="Vald is high scalable distributed high-speed approximate nearest neighbor search engine"><meta property="og:url" content="https://vald.vdaas.org/docs/v1.6/user-guides/upgrade-cluster/"><meta property="og:image" content="https://vald.vdaas.org//images/ogp_vald.png"><meta property="og:site_name" content="vald"><meta property="og:locale" content="en_US"><meta property="fb:app_id" content="615732422350002"><meta name=twitter:site content="@vdaas_vald"><meta name=twitter:card content="app"><link rel="shortcut icon" href=https://vald.vdaas.org//favicon.ico><link rel=stylesheet type=text/css href=/css/style.min.css><link rel=stylesheet type=text/css href=/css/header.min.css><link rel=stylesheet type=text/css href=/css/footer.min.css><link rel=stylesheet type=text/css href=/css/main.min.css><script type=text/javascript src=/js/script.min.js defer></script><meta name=viewport content="target-densitydpi=device-dpi,width=device-width,maximum-scale=1,user-scalable=yes"></head><body><header class=header id=header><div class=header__content><nav class=header__nav><a href=https://vald.vdaas.org/ class=header-nav__link><picture class=header-nav__image><source srcset=https://vald.vdaas.org//images/vald_white.svg media="(prefers-color-scheme: dark)"><img src=https://vald.vdaas.org//images/vald_color_1.svg alt>
</picture></a><a class=header-nav__icon id=nav-btn><span class=header-nav__button></span></a><ul class=header__list id=menu><li class=header__item><a href=/docs/v1.6/overview/about-vald class=header__link>About</a></li><li class=header__item><a href=/docs/v1.6/tutorial/get-started class=header__link>Get Started</a></li><li class=header__item><a href=/docs/v1.6/user-guides/sdks class=header__link>SDKs</a></li><li class=header__item><a href=/docs/v1.6 class=header__link>Docs</a></li><li class=header__item><a href=https://vdaas-vald.medium.com/ target=_blank class=header__link>Blog<br></a></li><li class=header__item><details class=header__version id=version_details><summary class=version__current id=current_version>v1.6</summary><ul class=version__list><il class=version__item><a href=javascript:void(0) class="version__link version__link--latest">v1.7.15</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.7</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.6</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.5</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.4</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.3</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.2</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.1</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.0</a></il></ul></details></li><li class=header__item><a class=header__git href=https://github.com/vdaas/vald target=_blank><picture class=git__logo><source srcset=https://vald.vdaas.org//images/logo_github_white.svg media="(prefers-color-scheme: dark)" width=18 height=18><img src=https://vald.vdaas.org//images/logo_github_black.svg alt=github width=18 height=18></picture><div class=git__star><p class=git__starnum id=git-star-num></p></div></a></li></ul></nav></div></header><main role=main><div class=single><aside class=page><nav><ul id=list-body><li class=withchild id=cat_Overview>Overview<ul><li class=index><a href=/docs/v1.6/overview/about-vald/>About Vald</a></li><li class=index><a href=/docs/v1.6/overview/architecture/>Architecture</a></li><li class=index><a href=/docs/v1.6/overview/data-flow/>Data Flow</a></li></ul></li><li class=withchild id=cat_Component>Component<ul><li class=index><a href=/docs/v1.6/overview/component/agent/>Agent</a></li><li class=index><a href=/docs/v1.6/overview/component/lb-gateway/>LB Gateway</a></li><li class=index><a href=/docs/v1.6/overview/component/filter-gateway/>Filter Gateway</a></li><li class=index><a href=/docs/v1.6/overview/component/discoverer/>Discoverer</a></li><li class=index><a href=/docs/v1.6/overview/component/index-manager/>Index Manager</a></li></ul></li><li class=withchild id=cat_Tutorial>Tutorial<ul><li class=index><a href=/docs/v1.6/tutorial/get-started/>Get Started</a></li><li class=index><a href=/docs/v1.6/tutorial/vald-agent-standalone-on-docker/>Vald Agent Standalone on Docker</a></li><li class=index><a href=/docs/v1.6/tutorial/vald-agent-standalone-on-k8s/>Vald Agent Standalone on K8s</a></li></ul></li><li class=withchild id=cat_Usecase>Usecase<ul><li class=index><a href=/docs/v1.6/usecase/usage-example/>Usage Example</a></li></ul></li><li class=withchild id="cat_User Guides">User Guides<ul><li class=index><a href=/docs/v1.6/user-guides/configuration/>Configuration</a></li><li class=index><a href=/docs/v1.6/user-guides/backup-configuration/>Backup Configuration</a></li><li class=index><a href=/docs/v1.6/user-guides/filtering-configuration/>Filtering Configuration</a></li><li class=index><a href=/docs/v1.6/user-guides/deployment/>Deployment</a></li><li class=index><a href=/docs/v1.6/user-guides/operations/>Operations</a></li><li class=view><a href=/docs/v1.6/user-guides/upgrade-cluster/>Upgrade Cluster</a></li><li class=index><a href=/docs/v1.6/user-guides/capacity-planning/>Capacity Planning</a></li><li class=index><a href=/docs/v1.6/user-guides/client-api-config/>Client Api Config</a></li><li class=index><a href=/docs/v1.6/user-guides/sdks/>Sdks</a></li></ul></li><li class=withchild id=cat_Performance>Performance<ul><li class=index><a href=/docs/v1.6/performance/benchmark/>Benchmark</a></li></ul></li><li class=withchild id=cat_Api>API<ul><li class=index><a href=/docs/v1.6/api/insert/>Insert</a></li><li class=index><a href=/docs/v1.6/api/update/>Update</a></li><li class=index><a href=/docs/v1.6/api/upsert/>Upsert</a></li><li class=index><a href=/docs/v1.6/api/search/>Search</a></li><li class=index><a href=/docs/v1.6/api/remove/>Remove</a></li><li class=index><a href=/docs/v1.6/api/object/>Object</a></li><li class=index><a href=/docs/v1.6/api/filter-gateway/>Filter Gateway</a></li><li class=index><a href=/docs/v1.6/api/status/>Status</a></li><li class=index><a href=/docs/v1.6/api/build_proto/>Build Proto</a></li></ul></li><li class=withchild id=cat_Troubleshooting>Troubleshooting<ul><li class=index><a href=/docs/v1.6/troubleshooting/provisioning/>Provisioning</a></li><li class=index><a href=/docs/v1.6/troubleshooting/client-side/>Client Side</a></li></ul></li><li class=withchild id=cat_Contributing>Contributing<ul><li class=index><a href=/docs/v1.6/contributing/contributing-guide/>Contributing Guide</a></li><li class=index><a href=/docs/v1.6/contributing/coding-style/>Coding Style</a></li><li class=index><a href=/docs/v1.6/contributing/unit-test-guideline/>Unit Test Guideline</a></li></ul></li><li class=withchild id=cat_Support>Support<ul></ul></li><li class=withchild id=cat_Release>Release<ul><li class=index><a href=/docs/v1.6/release/changelog/>Changelog</a></li></ul></li></ul></nav></aside><div class=content><div class=markdown id=markdown><h1 id=upgrade-vald-cluster>Upgrade Vald cluster</h1><p>Before this document, we recommend reading <a href=/docs/v1.6/user-guides/configuration>the configuration document</a> first.</p><h2 id=update-configuration>Update Configuration</h2><p>When you&rsquo;d like to update the configuration for the Vald cluster, you need to edit your configuration file and apply it according to your deployment method.
Please refer to one of the sections below according to your deployment method.</p><div class=caution>If each Vald Agent already has the indexes and uses the backup feature, please DO NOT edit the dimension and the distance type to avoid initContainer error.<br>(Each Vald Agent will restore from backup data when performing a rolling update)</div><div class=warn>The indexes will be clear when performing a rolling update if each Vald Agent already has the indexes and the backup feature disabled.</div><h3 id=using-helm-for-deployment>Using Helm for deployment</h3><p>The configuration file is <code>values.yaml</code>. (<a href=https://helm.sh/docs/chart_template_guide/values_files/>Helm Values</a>)</p><p>You can edit your <code>values.yaml</code> and update your Vald cluster by following steps:</p><ol><li><p>Edit <code>values.yaml</code>.</p></li><li><p>Update with Helm command.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm upgrade &lt;NAME&gt; vald/vald --values &lt;YOUR VALUES FILE PATH&gt;
</span></span><span style=display:flex><span><span style=color:#75715e># e.g., helm upgrade vald vald/vald --values valeus.yaml</span>
</span></span></code></pre></div></li></ol><h3 id=using-vald-helm-operator>Using vald-helm-operator</h3><p>There are two configuration files:</p><ul><li><code>vhor.yaml</code> for vald-helm-operator</li><li><code>vr.yaml</code> for the Vald cluster</li></ul><p>If you don&rsquo;t need to update the <code>vald-helm-operator</code>, please skip step.1 and step.2.
The Vald cluster will be updated by the following steps:</p><ol><li><p>Edit <code>vhor.yaml</code>.</p></li><li><p>Apply <code>vhor.yaml</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f &lt;VHOR YAML FILE PATH&gt;
</span></span><span style=display:flex><span><span style=color:#75715e># e.g., kubectl apply -f vhor.yaml</span>
</span></span></code></pre></div></li><li><p>Edit <code>vr.yaml</code>.</p></li><li><p>Apply <code>vr.yaml</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f &lt;VR YAML FILE PATH&gt;
</span></span><span style=display:flex><span><span style=color:#75715e># e.g., kubectl apply -f vr.yaml</span>
</span></span></code></pre></div></li></ol><h2 id=upgrade-vald-version>Upgrade Vald version</h2><p>We recommend using the latest Vald version.</p><p>If your Vald cluster uses an old version and you&rsquo;d like to upgrade the Vald version, you can upgrade by the following sections.
Please refer to one of the sections below according to your deployment method.</p><div class=caution>When the upgrade request is applied, Kubernetes will perform a rolling update.
If your Vald cluster does not apply backup, the index will be cleared by a rolling update.<br>In addition, if each Vald Agent already has the indexes and the backup feature enabled, please DO NOT edit the dimension and the distance type to avoid initContainer error.
(Each Vald Agent will restore from backup data when backup when performing a rolling update)</div><h3 id=using-helm-for-deployment-1>Using Helm for deployment</h3><p>Using the <code>Helm</code> command for the deployment of the Vald cluster, the upgrading steps are below.</p><div class=warn>Before upgrading, please confirm your Vald cluster version.<br>If there is major or minor upgrading, the chart structure may have changed.</div><ol><li><p>Verify vald repo in your helm repo</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo list
</span></span></code></pre></div></li><li><p>Update Helm repo</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo update &lt;NAME of Vald&gt;
</span></span><span style=display:flex><span><span style=color:#75715e># e.g., helm repo update vald</span>
</span></span></code></pre></div></li><li><p>Edit <code>values.yaml</code></p><ul><li><p>We recommend setting a specific version as an image tag.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>defaults</span>:
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>image</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>tag</span>: <span style=color:#ae81ff>v1.5.6</span> <span style=color:#75715e># set a new version</span>
</span></span></code></pre></div></li></ul></li><li><p>Apply <code>values.yaml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm upgrade &lt;NAME&gt; vald/vald --values &lt;YOUR VALUES FILE PATH&gt;
</span></span><span style=display:flex><span><span style=color:#75715e># e.g., helm upgrade vald vald/vald --values valeus.yaml</span>
</span></span></code></pre></div></li></ol><h3 id=using-vald-helm-operator-1>Using vald-helm-operator</h3><p>The upgrading steps are below if you use <code>vald-helm-operator</code> for the deployment.</p><ol><li><p>Upgrade CRDs</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl replace -f https://raw.githubusercontent.com/vdaas/vald/&lt;VERSION&gt;/charts/vald-helm-operator/crds/valdrelease.yaml
</span></span><span style=display:flex><span>kubectl replace -f https://raw.githubusercontent.com/vdaas/vald/&lt;VERSION&gt;/charts/vald-helm-operator/crds/valdhelmoperatorrelease.yaml
</span></span></code></pre></div></li><li><p>Update <code>vhor</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl patch vhor vhor-release -p <span style=color:#e6db74>&#39;{&#34;spec&#34;:{&#34;image&#34;:{&#34;tag&#34;:&#34;&lt;VERSION&gt;&#34;}}}&#39;</span>
</span></span></code></pre></div><ul><li>Also, you can upgrade manually by editing <code>vhor.yaml</code> and applying it.</li></ul></li><li><p>Edit <code>vr.yaml</code></p><ul><li><p>We recommend setting a specific version as an image tag.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>defaults</span>:
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>...</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>tag</span>: <span style=color:#ae81ff>v1.5.6</span> <span style=color:#75715e># set a new version</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>...</span>
</span></span></code></pre></div></li></ul></li><li><p>Apply <code>vr.yaml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f &lt;VR YAML FILE PATH&gt;
</span></span><span style=display:flex><span><span style=color:#75715e># e.g., kubectl apply -f vr.yaml</span>
</span></span></code></pre></div></li></ol></div><aside class=current id=current><button class=menu><span class=dot></span></button><nav id=TableOfContents><ul><li><a href=#update-configuration>Update Configuration</a><ul><li><a href=#using-helm-for-deployment>Using Helm for deployment</a></li><li><a href=#using-vald-helm-operator>Using vald-helm-operator</a></li></ul></li><li><a href=#upgrade-vald-version>Upgrade Vald version</a><ul><li><a href=#using-helm-for-deployment-1>Using Helm for deployment</a></li><li><a href=#using-vald-helm-operator-1>Using vald-helm-operator</a></li></ul></li></ul></nav></aside></div></div></main><footer class=footer><div class=footer__content><ul class=footer__index><li class=footer__item><a href=/docs/v1.6/overview/about-vald class=footer__link>About<br></a></li><li class=footer__item><a href=/docs/v1.6/tutorial/get-started class=footer__link>Get Started<br></a></li><li class=footer__item><a href=/docs/v1.6/user-guides/sdks class=footer__link>SDKs</a></li><li class=footer__item><a href=/docs/v1.6 class=footer__link>Docs</a></li><li class=footer__item><a href=https://vdaas-vald.medium.com/ target=_blank class=footer__link>Blog<br></a></li></ul><ul class=footer__sns><li class=footer__item><a class="footer__item footer__icon" href=https://x.com/vdaas_vald target=_blank><picture><source srcset=https://vald.vdaas.org//images/logo_x_white.svg media="(prefers-color-scheme: dark)" class=icon__image width=24 height=24><img src=https://vald.vdaas.org//images/logo_x_black.svg alt=x class=icon__image></picture></a></li><li class=footer__item><a class="footer__item footer__icon" href=https://join.slack.com/t/vald-community/shared_invite/zt-db2ky9o4-R_9p2sVp8xRwztVa8gfnPA target=_blank><picture><source srcset=https://vald.vdaas.org//images/logo_slack_white.svg media="(prefers-color-scheme: dark)" class=icon__image width=24 height=24><img src=https://vald.vdaas.org//images/logo_slack_black.svg alt=slack class=icon__image></picture></a></li><li class=footer__item><a class="footer__item footer__icon" href=https://github.com/vdaas/vald target=_blank><picture><source srcset=https://vald.vdaas.org//images/logo_github_white.svg media="(prefers-color-scheme: dark)" class=icon__image width=24 height=24><img src=https://vald.vdaas.org//images/logo_github_black.svg alt=github class=icon__image></picture></a></li></ul></div><p class=footer__copylight>©2019-2022 vald.vdaas.org Vald team</p></footer></body></html>