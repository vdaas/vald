<!doctype html><html><head><link rel=canonical href=https://vald.vdaas.org><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=robots content="noindex"><title>Vald | Architecture</title><meta name=description content="Vald is high scalable distributed high-speed approximate nearest neighbor search engine" }><meta name=format-detection content="telephone=no"><meta http-equiv=x-ua-compatible content="IE=edge"><meta property="og:type" content="article"><meta property="og:title" content="Vald | Architecture"><meta property="og:description" content="Vald is high scalable distributed high-speed approximate nearest neighbor search engine"><meta property="og:url" content="https://vald.vdaas.org"><meta property="og:image" content="https://vald.netlify.app/images/ogp_vald.png"><meta property="og:site_name" content="vald"><meta property="og:locale" content="en_US"><meta property="fb:app_id" content="615732422350002"><meta name=twitter:site content="@vdaas_vald"><meta name=twitter:card content="app"><link rel="shortcut icon" href=https://vald.netlify.app/favicon.ico><link rel=stylesheet type=text/css href=/css/style.min.css><link rel=stylesheet type=text/css href=/css/header.min.css><link rel=stylesheet type=text/css href=/css/footer.min.css><link rel=stylesheet type=text/css href=/css/main.min.css><script type=text/javascript src=/js/script.min.js defer></script></head><body><header class=header id=header><div class=header__content><nav class="header__nav cf"><a href=https://vald.netlify.app class=header-nav__link><picture>
<source srcset=https://vald.netlify.app/images/vald_white.svg media="(prefers-color-scheme: dark)" class=header-nav__image><img src=https://vald.netlify.app/images/vald_color_1.svg alt class=header-nav__image></picture></a>
<a class=header-nav__icon id=nav-btn><span class=header-nav__button></span></a><ul class=header__list id=menu><li class=header__item><a href=https://vald.netlify.app/docs/overview/about-vald class=header__link>About</a></li><li class=header__item><a href=https://vald.netlify.app/docs/tutorial/get-started class=header__link>Get Started</a></li><li class=header__item><a href=https://medium.com/@vdaas_vald target=_blank class=header__link>Blog<br></a></li><li class=header__item><a href=https://github.com/vdaas/vald target=_blank class="header__link header__link--button">Github</a></li></ul></nav></div></header><main role=main><div class=single><aside class=page><nav><button class=index id=list-button>Pages</button><ul id=list-body><li class=withchild id=menu_Overview>Overview<ul><ul><li class=index><a href=/docs/v0.0.46/overview/about-vald/>About Vald</a></li><ul><li class=view><a href=/docs/v0.0.46/overview/architecture/>Architecture</a></li></ul></li><li class=withchild id=menu_Tutorial>Tutorial<ul><ul><li class=index><a href=/docs/v0.0.46/tutorial/agent-on-docker/>Agent on Docker</a></li><ul><li class=index><a href=/docs/v0.0.46/tutorial/get-started/>Get Started</a></li></ul></li><li class=withchild id="menu_User Guides">User Guides<ul><ul><li class=index><a href=/docs/v0.0.46/user-guides/configuration/>Configuration</a></li></ul></li><li class=withchild id=menu_Usecase>Usecase<ul><ul><li class=index><a href=/docs/v0.0.46/usecase/usage-example/>Usage Example</a></li></ul></li><li class=withchild id=menu_Contributing>Contributing<ul><ul><li class=index><a href=/docs/v0.0.46/contributing/coding-style/>Coding Style</a></li><ul><li class=index><a href=/docs/v0.0.46/contributing/contributing-guide/>Contributing Guide</a></li></ul></li><li class=withchild id=menu_Support>Support<ul><ul><li class=index><a href=/docs/v0.0.46/support/contacts/>Contacts</a></li></ul></li><li class=withchild id=menu_Release>Release<ul><ul><li class=index><a href=/docs/v0.0.46/release/changelog/>Changelog</a></li></ul></li></ul><nav></aside><div class=content><div class=markdown id=markdown><h1 id=vald-architecture----omit-in-toc--->Vald Architecture</h1><p>This document describes the high-level architecture design of Vald and explains each component in Vald.</p><h2 id=overview>Overview</h2><p>Vald uses a cloud-native architecture focusing on <a href=https://kubernetes.io/>Kubernetes</a>.
Some components in Vald use Kubernetes API to control the behavior of distributed vector indexes.
Before reading this document, you need to have some understanding of the basic idea of cloud-native architecture and Kubernetes.</p><h3 id=concept>Concept</h3><p>Here are the concepts of Vald.</p><ul><li><p>Microservice based</p><p>Vald is designed based on the microservice architecture. Vald components are highly decoupled into small components and connected, which increases the overall agility and maintainability of Vald.</p></li><li><p>Containerized</p><p>All components in Vald are containerized, which means you can easily deploy Vald components on any environment.</p></li><li><p>Observability & Real-time monitoring</p><p>All Vald components support Cloud-Native based observability features such as Prometheus and Jaeger exporter.</p></li><li><p>Distributed vector spaces</p><p>All the vector data and indexes are distributed to Vald Agents in the Vald cluster. Whenever you search a vector in Vald cluster, all Vald agents can process parallelly and merge the result by Vald LB Gateway.</p></li><li><p>Kubernetes based</p><p>Vald can integrate with Kubernetes which enables the following features.</p><ul><li><p>Orchestrated</p><p>Kubernetes supports container orchestration. All components in Vald can be managed by Kubernetes automatically.</p></li><li><p>Horizontal scalable</p><p>All Vald components are designed and implemented to be scalable. You can add any node in Kubernetes cluster at any time to scale your Kuberentes cluster, or changing the number of replicas to scale Vald.</p></li><li><p>Auto-healing</p><p>Kubernetes supports the auto-healing feature. The pod can start a new instance automatically whenever the pod is down.</p></li><li><p>Data persistency</p><p>Vald implements backup features. Whenever a Vald Agent is down and kubernetes start a new Vald Agent instance, the data is automatically restored to the new instance to prevent data loss.</p></li><li><p>Easy to manage</p><p>Vald can be deployed easily on your Kubernetes cluster by using Helm charts. The custom resources and custom controllers are useful to manage your Vald cluster.</p></li></ul></li></ul><h2 id=data-flow>Data Flow</h2><p>This section describes the data flow inside Vald and how Vald&rsquo;s vector indexes are stored.
This is the most important part for the users to understand Vald.</p><p>The below image is the overview of Vald&rsquo;s architecture.</p><p><img src=/images/v0.0.46/vald_architecture_overview.png></p><p>We will explain this image in the following sections.</p><h3 id=insert>Insert</h3><p><img src=/images/v0.0.46/insert_flow.png></p><p>When the user inserts data into Vald:</p><ol><li>Vald Ingress receives the request from the user. The request includes the vector and the vector ID.</li><li>Vald Ingress will forward the request to the Vald Filter Gateway to pre-process the request data.</li><li>Vald Filter Gateway will forward the request to the user-defined Vald Ingress Filter. After the Vald Ingress Filter received the request, it will perform the pre-processing logic defined by the user, for example, padding the vector to match the vector dimension in Vald.</li><li>After the request is processed by the user-defined Vald Ingress Filter, the result will return to the Vald Filter Gateway.</li><li>Vald Filter Gateway will forward the processed data to the Vald Meta Gateway. Vald Meta Gateway will generate the UUID for each vector for internal use and the UUID will be mapped to the vector ID from the user&rsquo;s request. The reason of using UUID instead of vector ID is because the vector ID may be too long and it may increase the memory usage in Vald Agent.</li><li>Vald Meta Gateway will forward the request with the UUID to the Vald Backup Gateway, which will process the backup logic in 14-16 to prevent the data lost in Vald.</li><li>Vald Backup Gateway will forward the request to Vald LB Gateway. Vald LB Gateway will determine which Vald Agent(s) to process the request based on the resource usage of the nodes and pods, and the number of vector replicas.</li><li>Vald LB Gateway will forward the UUID and the vector data to the selected Vald Agents in parallel. Vald Agent will insert the vector and UUID in an on-memory vector queue. A vector queue will be committed to an ANN graph index by a <code>CreateIndex</code> instruction executed by the Vald Index Manager.</li><li>If Vald Agent successfully inserts the request data, it will return success to the Vald LB Gateway.</li><li>After Vald LB Gateway receives success from the selected Vald Agents, it will respond the IP addresses of all selected Vald Agents to the Vald Backup Gateway.</li><li>Vald Backup Gateway returns success to Vald Meta Gateway.</li><li>Vald Meta Gateway will forward the UUID(s) and vector ID(s) to the Vald Meta.</li><li>Vald Meta will store the UUID(s) and vector ID(s) that were successfully processed by the Vald Agent(s) to the persistent layer such as Redis, Cassandra, MySQL, etc.</li><li>Vald Backup Gateway will asynchronously send all the inserted the data (vector(s), vector ID(s), UUID(s) and IP address(es)) to the Vald Compressor. Vald Compressor will compress the vector data asynchronously to reduce the size of the vector data.</li><li>Vald Compressor will forward the data (compressed vector(s), vector ID(s), UUID(s) and IP address(es)) to the Vald Backup Manager.</li><li>Vald Backup Manager will store all of the data to the persistent layer such as MySQL, Cassandra, etc., to prevent the data lost in Vald.</li><li>Vald Meta Gateway will return success to the Vald Filter Gateway.</li><li>Vald Filter Gateway will return success to the Vald Ingress.</li></ol><h3 id=search>Search</h3><p><img src=/images/v0.0.46/search_flow.png></p><p>When the user searches a vector from Vald:</p><ol><li>Vald Ingress receives a search request from the user. Vald provides 2 searching interfaces to the user, the user can search by vector or search by the vector ID.</li><li>Vald Ingress will forward the request to the Vald Filter Gateway to pre-process the request data.</li><li>Vald Filter Gateway will forward the request to the user-defined Vald Ingress Filter. After the Vald Ingress Filter received the request, it will perform the pre-processing logic defined by the user, for example, padding the vector to match the vector dimension in Vald.</li><li>After the request is processed by the user-defined Vald Ingress Filter, the result will return to the Vald Filter Gateway.</li><li>Vald Filter Gateway will forward the request to the Vald Meta Gateway. Vald Meta Gateway is used to resolve the internal used UUID to the user inserted vector ID in step 10-11.</li><li>Vald Meta Gateway will forward the request to the Vald LB Gateway through the Vald Backup Gateway. Vald LB Gateway will preform the post-processing of the result in step 9 after the Vald Agent(s) return in step 8.</li><li>Vald LB Gateway will forward the request to all Vald Agents in parallel. Each Vald Agent will search the <em>k</em> nearest neighbor vectors in an on memory graph index.</li><li>Vald Agent returns the searching result to the Vald LB Gateway. The searching result includes the UUID, the vector distance, and the vector. The number of the result will be the same as requested.</li><li>Vald LB Gateway will aggregate all searching results from all Vald Agents, rank the result by the vector distance, and return the ranked result to the Vald Meta Gateway through the Vald Backup Gateway.</li><li>Vald Meta Gateway will forward the searching result to the Vald Meta to resolve the user-defined vector IDs from the internal used UUIDs.</li><li>Vald Meta will perform a search for the Vector IDs based on the internal used UUIDs.</li><li>Vald Meta will return the Vector IDs to the Vald Meta Gateway.</li><li>Vald Meta Gateway will combine the vectors and the vector IDs from the searching result and return to the Vald Filter Gateway.</li><li>Vald Filter Gateway will forward the request to the user-defined Vald Egress Filter to filter the final result. For example exclude the specific type of the result from the vector ID.</li><li>Vald Egress Filter will return the filtered result to the Vald Filter Gateway.</li><li>Vald Filter Gateway will return the final result to the Vald Ingress.</li></ol></div><aside class=current id=current><button class=menu><span class=dot></span></button><nav id=TableOfContents><ul><li><a href=#overview>Overview</a><ul><li><a href=#concept>Concept</a></li></ul></li><li><a href=#data-flow>Data Flow</a><ul><li><a href=#insert>Insert</a></li><li><a href=#search>Search</a></li></ul></li></ul></nav></aside></div></div></main><footer class=footer><div class="footer__content cf"><ul class=footer__list><li class=footer__item><a href=https://vald.netlify.app/docs/overview/about-vald class=footer__link>About<br></a></li><li class=footer__item><a href=https://vald.netlify.app/docs/tutorial/get-started class=footer__link>Get Started<br></a></li><li class=footer__item><a href=https://medium.com/@vdaas_vald target=_blank class=footer__link>Blog<br></a></li><li class=footer__item><a href=https://github.com/vdaas/vald target=_blank class="footer__link footer__link--button">Github<br></a></li></ul></div><p class=footer__copylight>Â©2019-2020 vald.vdaas.org Vald team</p></footer></body></html>