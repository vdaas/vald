<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-164223416-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-164223416-1');</script><link rel=canonical href=https://vald.vdaas.org><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=robots content="noindex"><title>Vald | Loadtest</title><meta name=description content="Vald is high scalable distributed high-speed approximate nearest neighbor search engine" }><meta name=format-detection content="telephone=no"><meta http-equiv=x-ua-compatible content="IE=edge"><meta property="og:type" content="article"><meta property="og:title" content="Vald | Loadtest"><meta property="og:description" content="Vald is high scalable distributed high-speed approximate nearest neighbor search engine"><meta property="og:url" content="https://vald.vdaas.org/docs/performance/loadtest/"><meta property="og:image" content="https://vald.vdaas.org/images/ogp_vald.png"><meta property="og:site_name" content="vald"><meta property="og:locale" content="en_US"><meta property="fb:app_id" content="615732422350002"><meta name=twitter:site content="@vdaas_vald"><meta name=twitter:card content="app"><link rel="shortcut icon" href=https://vald.vdaas.org/favicon.ico><link rel=stylesheet type=text/css href=/css/style.min.css><link rel=stylesheet type=text/css href=/css/header.min.css><link rel=stylesheet type=text/css href=/css/footer.min.css><link rel=stylesheet type=text/css href=/css/main.min.css><script type=text/javascript src=/js/script.min.js defer></script></head><body><header class=header id=header><div class=header__content><nav class="header__nav cf"><a href=https://vald.vdaas.org class=header-nav__link><picture>
<source srcset=https://vald.vdaas.org/images/vald_white.svg media="(prefers-color-scheme: dark)" class=header-nav__image><img src=https://vald.vdaas.org/images/vald_color_1.svg alt class=header-nav__image></picture></a>
<a class=header-nav__icon id=nav-btn><span class=header-nav__button></span></a><ul class=header__list id=menu><li class=header__item><a href=https://vald.vdaas.org/docs/overview/about-vald class=header__link>About</a></li><li class=header__item><a href=https://vald.vdaas.org/docs/tutorial/get-started class=header__link>Get Started</a></li><li class=header__item><a href=https://vald.vdaas.org/docs class=header__link>Docs</a></li><li class=header__item><a href=https://medium.com/@vdaas_vald target=_blank class=header__link>Blog<br></a></li><li class=header__item><a href=https://github.com/vdaas/vald target=_blank class="header__link header__link--button">Github</a></li></ul></nav></div></header><main role=main><div class=single><aside class=page><nav><button class=index id=list-button>Pages</button><ul id=list-body><li class=withchild id=menu_Overview>Overview<ul><li class=index><a href=/docs/overview/about-vald/>About Vald</a></li><li class=index><a href=/docs/overview/architecture/>Architecture</a></li></ul></li><li class=withchild id=menu_Tutorial>Tutorial<ul><li class=index><a href=/docs/tutorial/get-started/>Get Started</a></li><li class=index><a href=/docs/tutorial/agent-on-docker/>Agent on Docker</a></li></ul></li><li class=withchild id="menu_User Guides">User Guides<ul><li class=index><a href=/docs/user-guides/configuration/>Configuration</a></li><li class=index><a href=/docs/user-guides/operations/>Operations</a></li></ul></li><li class=withchild id=menu_Usecase>Usecase<ul><li class=index><a href=/docs/usecase/usage-example/>Usage Example</a></li></ul></li><li class=withchild id=menu_Performance>Performance<ul><li class=index><a href=/docs/performance/benchmark/>Benchmark</a></li><li class=view><a href=/docs/performance/loadtest/>Loadtest</a></li></ul></li><li class=withchild id=menu_Contributing>Contributing<ul><li class=index><a href=/docs/contributing/contributing-guide/>Contributing Guide</a></li><li class=index><a href=/docs/contributing/coding-style/>Coding Style</a></li></ul></li><li class=withchild id=menu_Support>Support<ul><li class=index><a href=/docs/support/contacts/>Contacts</a></li></ul></li></ul><nav></aside><div class=content><div class=markdown id=markdown><h1 id=load-testing>Load Testing</h1><p>This document describes how to perform the load testing in Vald cluster or Vald agent using Vald Load Testing Tools.</p><h2 id=overview>Overview</h2><p>We develop our own Load Testing Tools to perform the load testing in Vald cluster or Vald agent.
You can perform the load test on Vald to test the insert and search performance in Vald.</p><h2 id=prerequisite>Prerequisite</h2><ul><li><p>Vald Cluster or Vald Agent</p><p>Please refer to <a href=https://vald.vdaas.org/docs/tutorial/get-started/>here</a> for the installation guide of Vald Cluster or Vald Agent.</p></li><li><p>Docker: v19.03 ~</p></li></ul><h2 id=install-load-test-tools>Install load test tools</h2><p>We provide a docker image for the load testing.
Please download the image using the below command.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker pull vdaas/vald-loadtest
</code></pre></div><h2 id=configure-load-test-tools>Configure load test tools</h2><p>Please refer to the <a href=https://github.com/vdaas/vald/blob/master/cmd/tools/cli/loadtest/sample.yaml>Sample configuration file</a> to configure the Vald Load Testing Tools.</p><p>Here are the important configurations and following the explanation.</p><table><thead><tr><th align=left>Name</th><th align=left>Description</th><th align=left>Example</th></tr></thead><tbody><tr><td align=left>service</td><td align=left>By setting the value to gateway, you can test the Vald cluster though the Vald gateway.<br>By setting the value to agent, you can test the Vald agent directly.</td><td align=left>gateway or agent</td></tr><tr><td align=left>operation</td><td align=left>To perform the specific load test action to the Vald cluster.</td><td align=left>insert, streaminsert, search or steamsearch</td></tr><tr><td align=left>dataset</td><td align=left>The dataset used in insert and streaminsert operation.</td><td align=left></td></tr><tr><td align=left>concurrency</td><td align=left>The number of concurrent execution of the load test.</td><td align=left></td></tr><tr><td align=left>batch_size</td><td align=left>The batch size of the dataset.</td><td align=left></td></tr><tr><td align=left>addr</td><td align=left>The cluster you want to test</td><td align=left></td></tr></tbody></table><h2 id=execute-load-test>Execute load test</h2><p>Download the sample configuration file.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>wget https://raw.githubusercontent.com/vdaas/vald/master/cmd/tools/cli/loadtest/sample.yaml
mv sample.yaml config.yaml
</code></pre></div><p>Please refer to the <a href=#configure-load-test-tools>configure load test tools</a> section to configure the load testing tool.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>vi config.yaml
</code></pre></div><p>Execute the load test in docker.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker run -it --rm -v <span style=color:#66d9ef>$(</span>pwd<span style=color:#66d9ef>)</span>:/etc/server vald-load-test
</code></pre></div><h2 id=result>Result</h2><p>After the Vald Load Testing tools finished, the following output will be displayed.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>2020-07-13 08:10:45	<span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>:	maxprocs: Leaving GOMAXPROCS<span style=color:#f92672>=</span>8: CPU quota undefined
2020-07-13 08:10:45	<span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>:	service load test v0.0.0 starting...
2020-07-13 08:10:45	<span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>:	executing daemon pre-start <span style=color:#66d9ef>function</span>
2020-07-13 08:10:45	<span style=color:#f92672>[</span>DEBG<span style=color:#f92672>]</span>:	start loading: random-786-100000
2020-07-13 17:10:49	<span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>:	executing daemon start <span style=color:#66d9ef>function</span>
2020-07-13 17:10:49	<span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>:	start load test<span style=color:#f92672>(</span>Gateway, Insert<span style=color:#f92672>)</span>
2020-07-13 17:10:52	<span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>:	progress <span style=color:#ae81ff>177</span> requests, 5899.977806<span style=color:#f92672>[</span>vps<span style=color:#f92672>]</span>, error: <span style=color:#ae81ff>0</span>
2020-07-13 17:10:55	<span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>:	progress <span style=color:#ae81ff>370</span> requests, 6166.631312<span style=color:#f92672>[</span>vps<span style=color:#f92672>]</span>, error: <span style=color:#ae81ff>0</span>
2020-07-13 17:10:58	<span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>:	progress <span style=color:#ae81ff>558</span> requests, 6199.932718<span style=color:#f92672>[</span>vps<span style=color:#f92672>]</span>, error: <span style=color:#ae81ff>0</span>
2020-07-13 17:11:01	<span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>:	progress <span style=color:#ae81ff>727</span> requests, 6058.303243<span style=color:#f92672>[</span>vps<span style=color:#f92672>]</span>, error: <span style=color:#ae81ff>0</span>
2020-07-13 17:11:04	<span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>:	progress <span style=color:#ae81ff>910</span> requests, 6066.658704<span style=color:#f92672>[</span>vps<span style=color:#f92672>]</span>, error: <span style=color:#ae81ff>0</span>
2020-07-13 17:11:05	<span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>:	result:Gateway	32	100	6060.743248
2020-07-13 17:11:05	<span style=color:#f92672>[</span>WARN<span style=color:#f92672>]</span>:	terminated signal received daemon will stopping soon...
2020-07-13 17:11:05	<span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>:	executing daemon pre-stop <span style=color:#66d9ef>function</span>
2020-07-13 17:11:05	<span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>:	executing daemon stop <span style=color:#66d9ef>function</span>
2020-07-13 17:11:05	<span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>:	executing daemon post-stop <span style=color:#66d9ef>function</span>
2020-07-13 17:11:05	<span style=color:#f92672>[</span>ERR<span style=color:#f92672>]</span>:	error occured in runner.Wait at load test: context canceled
2020-07-13 17:11:05	<span style=color:#f92672>[</span>WARN<span style=color:#f92672>]</span>:	daemon stopped
</code></pre></div><p>These lines show the result of the load test.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>2020-07-13 08:10:45 <span style=color:#f92672>[</span>DEBG<span style=color:#f92672>]</span>: start loading: random-786-100000
...
2020-07-13 17:10:49 <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>: start load test<span style=color:#f92672>(</span>Gateway, Insert<span style=color:#f92672>)</span>
...
2020-07-13 17:11:05	<span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>:	result:Gateway	32	100	6060.743248
</code></pre></div><p>This means that the <code>Insert Gateway</code> mode is used, which means the dataset <code>random-786-100000</code> will insert into the Vald Cluster.</p><p>The line <code>result:Gateway 32 100 6060.743248</code> means that the Gateway mode is used, with <code>32</code> concurrent execution and <code>100</code> batch size, with the VPS (Vector Per Sec.) of <code>6060.743248</code>.</p><p>Which means that is performed the insertion of 6060 vectors into the Vald Cluster per second from the Vald Load Testing tools.</p><p>The result includes all the network latency and filtering latency.</p></div><aside class=current id=current><button class=menu><span class=dot></span></button><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#prerequisite>Prerequisite</a></li><li><a href=#install-load-test-tools>Install load test tools</a></li><li><a href=#configure-load-test-tools>Configure load test tools</a></li><li><a href=#execute-load-test>Execute load test</a></li><li><a href=#result>Result</a></li></ul></nav></aside></div></div></main><footer class=footer><div class="footer__content cf"><ul class=footer__list><li class=footer__item><a href=https://vald.vdaas.org/docs/overview/about-vald class=footer__link>About<br></a></li><li class=footer__item><a href=https://vald.vdaas.org/docs/tutorial/get-started class=footer__link>Get Started<br></a></li><li class=footer__item><a href=https://medium.com/@vdaas_vald target=_blank class=footer__link>Blog<br></a></li><li class=footer__item><a href=https://github.com/vdaas/vald target=_blank class="footer__link footer__link--button">Github<br></a></li></ul></div><p class=footer__copylight>Â©2019-2020 vald.vdaas.org Vald team</p></footer></body></html>