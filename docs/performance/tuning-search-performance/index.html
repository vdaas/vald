<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-F9Y0YKG55S"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F9Y0YKG55S")</script><link rel=canonical href=https://vald.vdaas.org><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=robots content='index, follow'><title>Vald | Tuning Search Performance</title>
<meta name=description content="Vald is high scalable distributed high-speed approximate nearest neighbor search engine" }><meta name=format-detection content="telephone=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta property="og:type" content="article"><meta property="og:title" content="Vald | Tuning Search Performance"><meta property="og:description" content="Vald is high scalable distributed high-speed approximate nearest neighbor search engine"><meta property="og:url" content="https://vald.vdaas.org/docs/performance/tuning-search-performance/"><meta property="og:image" content="https://vald.vdaas.org//images/ogp_vald.png"><meta property="og:site_name" content="vald"><meta property="og:locale" content="en_US"><meta property="fb:app_id" content="615732422350002"><meta name=twitter:site content="@vdaas_vald"><meta name=twitter:card content="app"><link rel="shortcut icon" href=https://vald.vdaas.org//favicon.ico><link rel=stylesheet type=text/css href=/css/style.min.css><link rel=stylesheet type=text/css href=/css/header.min.css><link rel=stylesheet type=text/css href=/css/footer.min.css><link rel=stylesheet type=text/css href=/css/main.min.css><script type=text/javascript src=/js/script.min.js defer></script><meta name=viewport content="target-densitydpi=device-dpi,width=device-width,maximum-scale=1,user-scalable=yes"></head><body><header class=header id=header><div class=header__content><nav class=header__nav><a href=https://vald.vdaas.org/ class=header-nav__link><picture class=header-nav__image><source srcset=https://vald.vdaas.org//images/vald_white.svg media="(prefers-color-scheme: dark)"><img src=https://vald.vdaas.org//images/vald_color_1.svg alt>
</picture></a><a class=header-nav__icon id=nav-btn><span class=header-nav__button></span></a><ul class=header__list id=menu><li class=header__item><a href=/docs/overview/about-vald class=header__link>About</a></li><li class=header__item><a href=/docs/tutorial/get-started class=header__link>Get Started</a></li><li class=header__item><a href=/docs/user-guides/sdks class=header__link>SDKs</a></li><li class=header__item><a href=/docs class=header__link>Docs</a></li><li class=header__item><a href=https://vdaas-vald.medium.com/ target=_blank class=header__link>Blog<br></a></li><li class=header__item><details class=header__version id=version_details><summary class=version__current id=current_version>v1.7.15</summary><ul class=version__list><il class=version__item><a href=javascript:void(0) class="version__link version__link--latest">v1.7.15</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.7</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.6</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.5</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.4</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.3</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.2</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.1</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.0</a></il></ul></details></li><li class=header__item><a class=header__git href=https://github.com/vdaas/vald target=_blank><picture class=git__logo><source srcset=https://vald.vdaas.org//images/logo_github_white.svg media="(prefers-color-scheme: dark)" width=18 height=18><img src=https://vald.vdaas.org//images/logo_github_black.svg alt=github width=18 height=18></picture><div class=git__star><p class=git__starnum id=git-star-num></p></div></a></li></ul></nav></div></header><main role=main><div class=single><aside class=page><nav><ul id=list-body><li class=withchild id=cat_Overview>Overview<ul><li class=index><a href=/docs/overview/about-vald/>About Vald</a></li><li class=index><a href=/docs/overview/architecture/>Architecture</a></li><li class=index><a href=/docs/overview/data-flow/>Data Flow</a></li></ul></li><li class=withchild id=cat_Component>Component<ul><li class=index><a href=/docs/overview/component/agent/>Agent</a></li><li class=index><a href=/docs/overview/component/lb-gateway/>Lb Gateway</a></li><li class=index><a href=/docs/overview/component/filter-gateway/>Filter Gateway</a></li><li class=index><a href=/docs/overview/component/discoverer/>Discoverer</a></li><li class=index><a href=/docs/overview/component/index-manager/>Index Manager</a></li><li class=index><a href=/docs/overview/component/mirror-gateway/>Mirror Gateway</a></li></ul></li><li class=withchild id=cat_Tutorial>Tutorial<ul><li class=index><a href=/docs/tutorial/get-started/>Get Started</a></li><li class=index><a href=/docs/tutorial/get-started-with-faiss-agent/>Get Started With Faiss Agent</a></li><li class=index><a href=/docs/tutorial/vald-agent-standalone-on-k8s/>Vald Agent Standalone on K8s</a></li><li class=index><a href=/docs/tutorial/vald-agent-standalone-on-docker/>Vald Agent Standalone on Docker</a></li><li class=index><a href=/docs/tutorial/vald-multicluster-on-k8s/>Vald Multicluster on K8s</a></li></ul></li><li class=withchild id=cat_Usecase>Usecase<ul><li class=index><a href=/docs/usecase/usage-example/>Usage Example</a></li></ul></li><li class=withchild id="cat_User Guides">User Guides<ul><li class=index><a href=/docs/user-guides/configuration/>Configuration</a></li><li class=index><a href=/docs/user-guides/backup-configuration/>Backup Configuration</a></li><li class=index><a href=/docs/user-guides/filtering-configuration/>Filtering Configuration</a></li><li class=index><a href=/docs/user-guides/mirroring-configuration/>Mirroring Configuration</a></li><li class=index><a href=/docs/user-guides/cluster-role-binding/>Cluster Role Binding</a></li><li class=index><a href=/docs/user-guides/deployment/>Deployment</a></li><li class=index><a href=/docs/user-guides/operations/>Operations</a></li><li class=index><a href=/docs/user-guides/upgrade-cluster/>Upgrade Cluster</a></li><li class=index><a href=/docs/user-guides/capacity-planning/>Capacity Planning</a></li><li class=index><a href=/docs/user-guides/client-api-config/>Client Api Config</a></li><li class=index><a href=/docs/user-guides/observability-configuration/>Observability Configuration</a></li><li class=index><a href=/docs/user-guides/network-policy/>Network Policy</a></li><li class=index><a href=/docs/user-guides/index-correction/>Index Correction</a></li><li class=index><a href=/docs/user-guides/sdks/>Sdks</a></li><li class=index><a href=/docs/user-guides/read-replica-and-rotator/>Read Replica and Rotator</a></li></ul></li><li class=withchild id=cat_Performance>Performance<ul><li class=index><a href=/docs/performance/benchmark/>Benchmark</a></li><li class=index><a href=/docs/performance/loadtest/>Loadtest</a></li><li class=index><a href=/docs/performance/continuous-benchmark/>Continuous Benchmark</a></li><li class=view><a href=/docs/performance/tuning-search-performance/>Tuning Search Performance</a></li></ul></li><li class=withchild id=cat_Api>API<ul><li class=index><a href=/docs/api/insert/>Insert</a></li><li class=index><a href=/docs/api/update/>Update</a></li><li class=index><a href=/docs/api/upsert/>Upsert</a></li><li class=index><a href=/docs/api/search/>Search</a></li><li class=index><a href=/docs/api/remove/>Remove</a></li><li class=index><a href=/docs/api/flush/>Flush</a></li><li class=index><a href=/docs/api/object/>Object</a></li><li class=index><a href=/docs/api/filter-gateway/>Filter Gateway</a></li><li class=index><a href=/docs/api/mirror-gateway/>Mirror Gateway</a></li><li class=index><a href=/docs/api/status/>Status</a></li><li class=index><a href=/docs/api/build_proto/>Build</a></li></ul></li><li class=withchild id=cat_Troubleshooting>Troubleshooting<ul><li class=index><a href=/docs/troubleshooting/client-side/>Client Side</a></li><li class=index><a href=/docs/troubleshooting/provisioning/>Provisioning</a></li><li class=index><a href=/docs/troubleshooting/mirror-gateway/>Mirror Gateway</a></li></ul></li><li class=withchild id=cat_Contributing>Contributing<ul><li class=index><a href=/docs/contributing/contributing-guide/>Contributing Guide</a></li><li class=index><a href=/docs/contributing/development/>Development</a></li><li class=index><a href=/docs/contributing/coding-style/>Coding Style</a></li><li class=index><a href=/docs/contributing/unit-test-guideline/>Unit Test Guideline</a></li><li class=index><a href=/docs/contributing/reviewer-guideline/>Reviewer Guideline</a></li></ul></li><li class=withchild id=cat_Support>Support<ul><li class=index><a href=/docs/support/contacts/>Contacts</a></li><li class=index><a href=/docs/support/faq/>FAQ</a></li></ul></li><li class=withchild id=cat_Release>Release<ul><li class=index><a href=/docs/release/changelog/>Changelog</a></li></ul></li></ul></nav></aside><div class=content><div class=markdown id=markdown><h1 id=tuning-search-performance>Tuning Search Performance</h1><p>ANN is fast, but sometimes it can be improved more by tuning parameters.
This page shows the essence for improve ANN search by the Vald cluster.</p><h2 id=tuning-guideline>Tuning Guideline</h2><p>When the search results do NOT satisfy the expected result, it can be improved by tuning parameters.</p><p>First of all, we recommend tuning by following the steps below without doing it blindly.</p><pre class=mermaid>flowchart TD
    A[Perform Linear Search API]
    B{Is satisfies?}
    C[Tuning Parameters to improve precision]
    D[Tuning Embedding Models]
    E[Perform Search API]
    F[Tuning Parameters to improve latency]
    A-->B
    B-- Yes -->C
    B-- No -->D
    C--> E
    E--> C
    E--> F
    F--> E
</pre><p>The best practice is:</p><ol><li>Measure <a href=/docs/docs/api/search#linearsearch-rpc>Linear Search</a> performance and use it as a baseline for Search API</li><li>Repeat tuning to improve precision and measure Search API until the conditions are met</li><li>Repeat tuning to improve latency and measure Search API until the conditions are met</li></ol><div class=notice>When the results are not good by Linear Search API, it may need to rethink the embedding model for vectorization.</div><h2 id=tuning-parameters>Tuning parameters</h2><p>There are two viewpoints, client-side and cluster-side, for improving search performance.</p><div class=notice>There is a trade-off between search speed and accuracy, so tuning accuracy at first is recommended.</div><h3 id=client-side>Client side</h3><p>On the client side, parameters of <a href=/docs/docs/api/search#input><code>Search.Config</code></a> will affect the search result.</p><table><thead><tr><th style=text-align:left></th><th style=text-align:left>description</th><th style=text-align:left>how does it affect?</th><th style=text-align:left>memo</th></tr></thead><tbody><tr><td style=text-align:left>radius</td><td style=text-align:left>the search radius for NGT<br><a href=https://github.com/yahoojapan/NGT/tree/main/bin/ngt#search>ref: search_radius</a></td><td style=text-align:left>Define the search range when NGT searches the nearest neighbors</td><td style=text-align:left>recommended value: <code>-1</code></td></tr><tr><td style=text-align:left>epsilon</td><td style=text-align:left>the search coefficient for NGT<br><a href=https://github.com/yahoojapan/NGT/tree/main/bin/ngt#search>ref: search_range_coefficient</a></td><td style=text-align:left>Expansion factor of the NGT search range.<br>Search operation time increases when the epsilon is big.</td><td style=text-align:left>recommended value range: <code>0.01 ~ 0.3</code><br>default value: <code>0.1</code></td></tr><tr><td style=text-align:left>timeout(ns)</td><td style=text-align:left>max time duration until receiving search results.</td><td style=text-align:left>An error will be returned if the set <code>num</code> search results cannot be obtained within the set time.<br>By setting <code>min_num</code>, the search results will be returned if more than <code>min_num</code> can be searched within the time.</td><td style=text-align:left>default value: <code>3,000,000,000ns</code></td></tr></tbody></table><h3 id=cluster-side>Cluster-side</h3><p>On the cluster side, these parameters can be set by <code>values.yaml</code>, affect the search result.</p><table><thead><tr><th style=text-align:left></th><th style=text-align:left>description</th><th style=text-align:left>how does it affect?</th><th style=text-align:left>Memo</th></tr></thead><tbody><tr><td style=text-align:left>agent.ngt.creation_edge_size</td><td style=text-align:left>Number of nodes connected to one node<br><a href=https://github.com/yahoojapan/NGT/tree/main/bin/ngt#create>ref: no_of_edges</a></td><td style=text-align:left>It helps reduce unreachable edges.<br>The larger it is, the denser the graph structure will be, but the memory usage, search speed, and index construction time will increase accordingly.</td><td style=text-align:left>default value: <code>20</code></td></tr><tr><td style=text-align:left>agent.ngt.search_edge_size</td><td style=text-align:left>Number of nodes to search from the origin node when searching<br><a href=https://github.com/yahoojapan/NGT/tree/main/bin/ngt#create>ref: no_of_edges_at_search_at</a></td><td style=text-align:left>The number of nodes to search will increase.<br>Accuracy will be higher, but speed will be lower.<br>Adjust if adjusting the radius and epsilon does not improve the situation.</td><td style=text-align:left>default value: <code>10</code></td></tr></tbody></table><h2>See also</h2><div class=cardlist><a href=/docs/performance/benchmark/ class=cardlist__card><p class=card__title>Benchmark</p><p class=card__text>Measuring performance of Vald cluster</p></a><a href=/docs/performance/loadtest/ class=cardlist__card><p class=card__title>Loadtest</p><p class=card__text>Shows how to perform load test in the Vald cluster</p></a><a href=/docs/performance/continuous-benchmark/ class=cardlist__card><p class=card__title>Continuous Benchmark</p><p class=card__text>Performance verification using continuous benchmark tool</p></a></div></div><aside class=current id=current><button class=menu><span class=dot></span></button><nav id=TableOfContents><ul><li><a href=#tuning-guideline>Tuning Guideline</a></li><li><a href=#tuning-parameters>Tuning parameters</a><ul><li><a href=#client-side>Client side</a></li><li><a href=#cluster-side>Cluster-side</a></li></ul></li></ul></nav></aside></div><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true, theme: 'neutral', darkMode: false });
  </script></div></main><footer class=footer><div class=footer__content><ul class=footer__index><li class=footer__item><a href=/docs/overview/about-vald class=footer__link>About<br></a></li><li class=footer__item><a href=/docs/tutorial/get-started class=footer__link>Get Started<br></a></li><li class=footer__item><a href=/docs/user-guides/sdks class=footer__link>SDKs</a></li><li class=footer__item><a href=/docs class=footer__link>Docs</a></li><li class=footer__item><a href=https://vdaas-vald.medium.com/ target=_blank class=footer__link>Blog<br></a></li></ul><ul class=footer__sns><li class=footer__item><a class="footer__item footer__icon" href=https://x.com/vdaas_vald target=_blank><picture><source srcset=https://vald.vdaas.org//images/logo_x_white.svg media="(prefers-color-scheme: dark)" class=icon__image width=24 height=24><img src=https://vald.vdaas.org//images/logo_x_black.svg alt=x class=icon__image></picture></a></li><li class=footer__item><a class="footer__item footer__icon" href=https://join.slack.com/t/vald-community/shared_invite/zt-db2ky9o4-R_9p2sVp8xRwztVa8gfnPA target=_blank><picture><source srcset=https://vald.vdaas.org//images/logo_slack_white.svg media="(prefers-color-scheme: dark)" class=icon__image width=24 height=24><img src=https://vald.vdaas.org//images/logo_slack_black.svg alt=slack class=icon__image></picture></a></li><li class=footer__item><a class="footer__item footer__icon" href=https://github.com/vdaas/vald target=_blank><picture><source srcset=https://vald.vdaas.org//images/logo_github_white.svg media="(prefers-color-scheme: dark)" class=icon__image width=24 height=24><img src=https://vald.vdaas.org//images/logo_github_black.svg alt=github class=icon__image></picture></a></li></ul></div><p class=footer__copylight>©2019-2024 vald.vdaas.org Vald team</p></footer></body></html>