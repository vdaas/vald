<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-F9Y0YKG55S"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F9Y0YKG55S")</script><link rel=canonical href=https://vald.vdaas.org><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=robots content='index, follow'><title>Vald | Vald Multicluster on K8s</title>
<meta name=description content="Vald is high scalable distributed high-speed approximate nearest neighbor search engine" }><meta name=format-detection content="telephone=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta property="og:type" content="article"><meta property="og:title" content="Vald | Vald Multicluster on K8s"><meta property="og:description" content="Vald is high scalable distributed high-speed approximate nearest neighbor search engine"><meta property="og:url" content="https://vald.vdaas.org/docs/v1.7/tutorial/vald-multicluster-on-k8s/"><meta property="og:image" content="https://vald.vdaas.org//images/ogp_vald.png"><meta property="og:site_name" content="vald"><meta property="og:locale" content="en_US"><meta property="fb:app_id" content="615732422350002"><meta name=twitter:site content="@vdaas_vald"><meta name=twitter:card content="app"><link rel="shortcut icon" href=https://vald.vdaas.org//favicon.ico><link rel=stylesheet type=text/css href=/css/style.min.css><link rel=stylesheet type=text/css href=/css/header.min.css><link rel=stylesheet type=text/css href=/css/footer.min.css><link rel=stylesheet type=text/css href=/css/main.min.css><script type=text/javascript src=/js/script.min.js defer></script><meta name=viewport content="target-densitydpi=device-dpi,width=device-width,maximum-scale=1,user-scalable=yes"></head><body><header class=header id=header><div class=header__content><nav class=header__nav><a href=https://vald.vdaas.org/ class=header-nav__link><picture class=header-nav__image><source srcset=https://vald.vdaas.org//images/vald_white.svg media="(prefers-color-scheme: dark)"><img src=https://vald.vdaas.org//images/vald_color_1.svg alt>
</picture></a><a class=header-nav__icon id=nav-btn><span class=header-nav__button></span></a><ul class=header__list id=menu><li class=header__item><a href=/docs/v1.7/overview/about-vald class=header__link>About</a></li><li class=header__item><a href=/docs/v1.7/tutorial/get-started class=header__link>Get Started</a></li><li class=header__item><a href=/docs/v1.7/user-guides/sdks class=header__link>SDKs</a></li><li class=header__item><a href=/docs/v1.7 class=header__link>Docs</a></li><li class=header__item><a href=https://vdaas-vald.medium.com/ target=_blank class=header__link>Blog<br></a></li><li class=header__item><details class=header__version id=version_details><summary class=version__current id=current_version>v1.7</summary><ul class=version__list><il class=version__item><a href=javascript:void(0) class="version__link version__link--latest">v1.7.16</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.7</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.6</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.5</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.4</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.3</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.2</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.1</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.0</a></il></ul></details></li><li class=header__item><a class=header__git href=https://github.com/vdaas/vald target=_blank><picture class=git__logo><source srcset=https://vald.vdaas.org//images/logo_github_white.svg media="(prefers-color-scheme: dark)" width=18 height=18><img src=https://vald.vdaas.org//images/logo_github_black.svg alt=github width=18 height=18></picture><div class=git__star><p class=git__starnum id=git-star-num></p></div></a></li></ul></nav></div></header><main role=main><div class=single><aside class=page><nav><ul id=list-body><li class=withchild id=cat_Overview>Overview<ul><li class=index><a href=/docs/v1.7/overview/about-vald/>About Vald</a></li><li class=index><a href=/docs/v1.7/overview/architecture/>Architecture</a></li><li class=index><a href=/docs/v1.7/overview/data-flow/>Data Flow</a></li></ul></li><li class=withchild id=cat_Component>Component<ul><li class=index><a href=/docs/v1.7/overview/component/agent/>Agent</a></li><li class=index><a href=/docs/v1.7/overview/component/lb-gateway/>Lb Gateway</a></li><li class=index><a href=/docs/v1.7/overview/component/filter-gateway/>Filter Gateway</a></li><li class=index><a href=/docs/v1.7/overview/component/discoverer/>Discoverer</a></li><li class=index><a href=/docs/v1.7/overview/component/index-manager/>Index Manager</a></li><li class=index><a href=/docs/v1.7/overview/component/mirror-gateway/>Mirror Gateway</a></li></ul></li><li class=withchild id=cat_Tutorial>Tutorial<ul><li class=index><a href=/docs/v1.7/tutorial/get-started/>Get Started</a></li><li class=index><a href=/docs/v1.7/tutorial/get-started-with-faiss-agent/>Get Started With Faiss Agent</a></li><li class=index><a href=/docs/v1.7/tutorial/vald-agent-standalone-on-k8s/>Vald Agent Standalone on K8s</a></li><li class=index><a href=/docs/v1.7/tutorial/vald-agent-standalone-on-docker/>Vald Agent Standalone on Docker</a></li><li class=view><a href=/docs/v1.7/tutorial/vald-multicluster-on-k8s/>Vald Multicluster on K8s</a></li></ul></li><li class=withchild id=cat_Usecase>Usecase<ul><li class=index><a href=/docs/v1.7/usecase/usage-example/>Usage Example</a></li></ul></li><li class=withchild id="cat_User Guides">User Guides<ul><li class=index><a href=/docs/v1.7/user-guides/configuration/>Configuration</a></li><li class=index><a href=/docs/v1.7/user-guides/backup-configuration/>Backup Configuration</a></li><li class=index><a href=/docs/v1.7/user-guides/filtering-configuration/>Filtering Configuration</a></li><li class=index><a href=/docs/v1.7/user-guides/mirroring-configuration/>Mirroring Configuration</a></li><li class=index><a href=/docs/v1.7/user-guides/cluster-role-binding/>Cluster Role Binding</a></li><li class=index><a href=/docs/v1.7/user-guides/deployment/>Deployment</a></li><li class=index><a href=/docs/v1.7/user-guides/operations/>Operations</a></li><li class=index><a href=/docs/v1.7/user-guides/upgrade-cluster/>Upgrade Cluster</a></li><li class=index><a href=/docs/v1.7/user-guides/capacity-planning/>Capacity Planning</a></li><li class=index><a href=/docs/v1.7/user-guides/client-api-config/>Client Api Config</a></li><li class=index><a href=/docs/v1.7/user-guides/observability-configuration/>Observability Configuration</a></li><li class=index><a href=/docs/v1.7/user-guides/network-policy/>Network Policy</a></li><li class=index><a href=/docs/v1.7/user-guides/index-correction/>Index Correction</a></li><li class=index><a href=/docs/v1.7/user-guides/sdks/>Sdks</a></li><li class=index><a href=/docs/v1.7/user-guides/read-replica-and-rotator/>Read Replica and Rotator</a></li></ul></li><li class=withchild id=cat_Performance>Performance<ul><li class=index><a href=/docs/v1.7/performance/benchmark/>Benchmark</a></li><li class=index><a href=/docs/v1.7/performance/loadtest/>Loadtest</a></li><li class=index><a href=/docs/v1.7/performance/continuous-benchmark/>Continuous Benchmark</a></li><li class=index><a href=/docs/v1.7/performance/tuning-search-performance/>Tuning Search Performance</a></li></ul></li><li class=withchild id=cat_Api>API<ul><li class=index><a href=/docs/v1.7/api/insert/>Insert</a></li><li class=index><a href=/docs/v1.7/api/update/>Update</a></li><li class=index><a href=/docs/v1.7/api/upsert/>Upsert</a></li><li class=index><a href=/docs/v1.7/api/search/>Search</a></li><li class=index><a href=/docs/v1.7/api/remove/>Remove</a></li><li class=index><a href=/docs/v1.7/api/flush/>Flush</a></li><li class=index><a href=/docs/v1.7/api/object/>Object</a></li><li class=index><a href=/docs/v1.7/api/filter-gateway/>Filter Gateway</a></li><li class=index><a href=/docs/v1.7/api/mirror-gateway/>Mirror Gateway</a></li><li class=index><a href=/docs/v1.7/api/status/>Status</a></li><li class=index><a href=/docs/v1.7/api/build_proto/>Build</a></li></ul></li><li class=withchild id=cat_Troubleshooting>Troubleshooting<ul><li class=index><a href=/docs/v1.7/troubleshooting/client-side/>Client Side</a></li><li class=index><a href=/docs/v1.7/troubleshooting/provisioning/>Provisioning</a></li><li class=index><a href=/docs/v1.7/troubleshooting/mirror-gateway/>Mirror Gateway</a></li></ul></li><li class=withchild id=cat_Contributing>Contributing<ul><li class=index><a href=/docs/v1.7/contributing/contributing-guide/>Contributing Guide</a></li><li class=index><a href=/docs/v1.7/contributing/development/>Development</a></li><li class=index><a href=/docs/v1.7/contributing/coding-style/>Coding Style</a></li><li class=index><a href=/docs/v1.7/contributing/unit-test-guideline/>Unit Test Guideline</a></li><li class=index><a href=/docs/v1.7/contributing/reviewer-guideline/>Reviewer Guideline</a></li></ul></li><li class=withchild id=cat_Support>Support<ul><li class=index><a href=/docs/v1.7/support/contacts/>Contacts</a></li><li class=index><a href=/docs/v1.7/support/faq/>FAQ</a></li></ul></li><li class=withchild id=cat_Release>Release<ul><li class=index><a href=/docs/v1.7/release/changelog/>Changelog</a></li></ul></li></ul></nav></aside><div class=content><div class=markdown id=markdown><h1 id=multiple-vald-clusters-using-vald-mirror-gateway>Multiple Vald Clusters using Vald Mirror Gateway</h1><p>This article shows how to deploy multiple Vald clusters on your Kubernetes cluster.</p><h2 id=overview>Overview</h2><p>Vald cluster consists of multiple microservices.</p><p>In <a href=https://vald.vdaas.org/docs/tutorial/get-started>Get Started</a>, you may use 4 kinds of components to deploy the Vald cluster.</p><p>In this tutorial, you will deploy multiple Vald clusters with Vald Mirror Gateway, which connects another Vald cluster.</p><p>The below image shows the architecture image of this case.</p><img src=/images/v1.7/tutorial/vald-multicluster-on-k8s.png><h2 id=requirements>Requirements</h2><ul><li>Vald: v1.8 ~</li><li>Kubernetes: v1.27 ~</li><li>Go: v1.20 ~</li><li>Helm: v3 ~</li><li>libhdf5 (<em>only required to get started</em>)</li></ul><p>Helm is used to deploy Vald cluster on your Kubernetes and HDF5 is used to decode the sample data file to run the example code.</p><p>If Helm or HDF5 is not installed, please install <a href=https://helm.sh/docs/intro/install>Helm</a> and <a href=https://www.hdfgroup.org/>HDF5</a>.</p><details><summary>Installation command for Helm</summary><br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
</span></span></code></pre></div></details><details><summary>Installation command for HDF5</summary><br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># yum</span>
</span></span><span style=display:flex><span>yum install -y hdf5-devel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># apt</span>
</span></span><span style=display:flex><span>apt-get install libhdf5-serial-dev
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># homebrew</span>
</span></span><span style=display:flex><span>brew install hdf5
</span></span></code></pre></div></details><h2 id=prepare-the-kubernetes-cluster>Prepare the Kubernetes Cluster</h2><p>This tutorial requires the Kubernetes cluster.</p><p>Vald cluster runs on public Cloud Kubernetes Services such as GKE, EKS.
In the sense of trying to <code>Get Started</code>, <a href=https://k3d.io/>k3d</a> or <a href=https://kind.sigs.k8s.io/>kind</a> are easy Kubernetes tools to use.</p><p>This tutorial uses <a href=https://github.com/kubernetes-sigs/metrics-server>Kubernetes Metrics Server</a> for running the Vald cluster.</p><p>Please make sure these functions are available.</p><p>The way to deploy Kubernetes Metrics Service is here:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>kubectl wait -n kube-system --for<span style=color:#f92672>=</span>condition<span style=color:#f92672>=</span>ready pod -l k8s-app<span style=color:#f92672>=</span>metrics-server --timeout<span style=color:#f92672>=</span>600s
</span></span></code></pre></div><p>Please prepare three Namespaces on the Kubernetes cluster.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create namespace vald-01 <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>kubectl create namespace vald-02 <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>kubectl create namespace vald-03
</span></span></code></pre></div><h2 id=deploy-vald-clusters-on-each-kubernetes-namespace>Deploy Vald Clusters on each Kubernetes Namespace</h2><p>This chapter shows how to deploy the multiple Vald clusters using Helm and run it on your Kubernetes cluster.
In this section, you will deploy three Vald clusters consisting of <code>vald-agent-ngt</code>, <code>vald-lb-gateway</code>, <code>vald-discoverer</code>, <code>vald-manager-index</code>, and <code>vald-mirror-gateway</code> using the basic configuration.</p><ol><li><p>Clone the repository</p><p>To use the <code>deployment</code> YAML for deployment, let’s clone <code>[vdaas/vald](https://github.com/vdaas/vald.git)</code> repository.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/vdaas/vald.git <span style=color:#f92672>&amp;&amp;</span>　cd vald
</span></span></code></pre></div></li><li><p>Deploy on the <code>vald-01</code> Namespace using <a href=https://github.com/vdaas/vald/blob/main/charts/vald/values/multi-vald/dev-vald-01.yaml>dev-vald-01.yaml</a> and <a href=https://github.com/vdaas/vald/blob/main/example/helm/values.yaml>values.yaml</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install vald-cluster-01 charts/vald <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -f ./example/helm/values.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -f ./charts/vald/values/multi-vald/dev-vald-01.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -n vald-01
</span></span></code></pre></div></li><li><p>Deploy on the <code>vald-02</code> Namespace using <a href=https://github.com/vdaas/vald/blob/main/charts/vald/values/multi-vald/dev-vald-02.yaml>dev-vald-02.yaml</a> and <a href=https://github.com/vdaas/vald/blob/main/example/helm/values.yaml>values.yaml</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install vald-cluster-02 charts/vald <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -f ./example/helm/values.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -f ./charts/vald/values/multi-vald/dev-vald-02.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -n vald-02
</span></span></code></pre></div></li><li><p>Deploy on the <code>vald-03</code> Namespace using <a href=https://github.com/vdaas/vald/blob/main/charts/vald/values/multi-vald/dev-vald-03.yaml>dev-vald-03.yaml</a> and <a href=https://github.com/vdaas/vald/blob/main/example/helm/values.yaml>values.yaml</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install vald-cluster-03 charts/vald <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -f ./example/helm/values.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -f ./charts/vald/values/multi-vald/dev-vald-03.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -n vald-03
</span></span></code></pre></div></li><li><p>Verify</p><p>If success deployment, the Vald cluster’s components should run on each Kubernetes Namespace.</p><details><summary>vald-01 Namespace</summary><br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods -n vald-01
</span></span><span style=display:flex><span>NAME                                   READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>vald-agent-ngt-0                       1/1     Running   <span style=color:#ae81ff>0</span>          2m41s
</span></span><span style=display:flex><span>vald-agent-ngt-2                       1/1     Running   <span style=color:#ae81ff>0</span>          2m41s
</span></span><span style=display:flex><span>vald-agent-ngt-3                       1/1     Running   <span style=color:#ae81ff>0</span>          2m41s
</span></span><span style=display:flex><span>vald-agent-ngt-4                       1/1     Running   <span style=color:#ae81ff>0</span>          2m41s
</span></span><span style=display:flex><span>vald-agent-ngt-5                       1/1     Running   <span style=color:#ae81ff>0</span>          2m41s
</span></span><span style=display:flex><span>vald-agent-ngt-1                       1/1     Running   <span style=color:#ae81ff>0</span>          2m41s
</span></span><span style=display:flex><span>vald-discoverer-77967c9697-brbsp       1/1     Running   <span style=color:#ae81ff>0</span>          2m41s
</span></span><span style=display:flex><span>vald-lb-gateway-587879d598-xmws7       1/1     Running   <span style=color:#ae81ff>0</span>          2m41s
</span></span><span style=display:flex><span>vald-lb-gateway-587879d598-dzn9c       1/1     Running   <span style=color:#ae81ff>0</span>          2m41s
</span></span><span style=display:flex><span>vald-manager-index-56d474c848-wkh6b    1/1     Running   <span style=color:#ae81ff>0</span>          2m41s
</span></span><span style=display:flex><span>vald-lb-gateway-587879d598-9wb5q       1/1     Running   <span style=color:#ae81ff>0</span>          2m41s
</span></span><span style=display:flex><span>vald-mirror-gateway-6df75cf7cf-gzcr4   1/1     Running   <span style=color:#ae81ff>0</span>          2m26s
</span></span><span style=display:flex><span>vald-mirror-gateway-6df75cf7cf-vjbqx   1/1     Running   <span style=color:#ae81ff>0</span>          2m26s
</span></span><span style=display:flex><span>vald-mirror-gateway-6df75cf7cf-c2g7t   1/1     Running   <span style=color:#ae81ff>0</span>          2m41s
</span></span></code></pre></div></details><details><summary>vald-02 Namespace</summary><br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods -n vald-02
</span></span><span style=display:flex><span>NAME                                  READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>vald-agent-ngt-0                      1/1     Running   <span style=color:#ae81ff>0</span>          2m52s
</span></span><span style=display:flex><span>vald-agent-ngt-1                      1/1     Running   <span style=color:#ae81ff>0</span>          2m52s
</span></span><span style=display:flex><span>vald-agent-ngt-2                      1/1     Running   <span style=color:#ae81ff>0</span>          2m52s
</span></span><span style=display:flex><span>vald-agent-ngt-4                      1/1     Running   <span style=color:#ae81ff>0</span>          2m52s
</span></span><span style=display:flex><span>vald-agent-ngt-5                      1/1     Running   <span style=color:#ae81ff>0</span>          2m52s
</span></span><span style=display:flex><span>vald-agent-ngt-3                      1/1     Running   <span style=color:#ae81ff>0</span>          2m52s
</span></span><span style=display:flex><span>vald-discoverer-8cfcff76-vlmpg        1/1     Running   <span style=color:#ae81ff>0</span>          2m52s
</span></span><span style=display:flex><span>vald-lb-gateway-54896f9f49-wtlcv      1/1     Running   <span style=color:#ae81ff>0</span>          2m52s
</span></span><span style=display:flex><span>vald-lb-gateway-54896f9f49-hbklj      1/1     Running   <span style=color:#ae81ff>0</span>          2m52s
</span></span><span style=display:flex><span>vald-manager-index-676855f8d7-bb4wb   1/1     Running   <span style=color:#ae81ff>0</span>          2m52s
</span></span><span style=display:flex><span>vald-lb-gateway-54896f9f49-kgrdf      1/1     Running   <span style=color:#ae81ff>0</span>          2m52s
</span></span><span style=display:flex><span>vald-mirror-gateway-6598cf957-t2nz4   1/1     Running   <span style=color:#ae81ff>0</span>          2m37s
</span></span><span style=display:flex><span>vald-mirror-gateway-6598cf957-wr448   1/1     Running   <span style=color:#ae81ff>0</span>          2m52s
</span></span><span style=display:flex><span>vald-mirror-gateway-6598cf957-jdd6q   1/1     Running   <span style=color:#ae81ff>0</span>          2m37s
</span></span></code></pre></div></details><details><summary>vald-03 Namespace</summary><br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods -n vald-03
</span></span><span style=display:flex><span>NAME                                   READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>vald-agent-ngt-0                       1/1     Running   <span style=color:#ae81ff>0</span>          2m46s
</span></span><span style=display:flex><span>vald-agent-ngt-1                       1/1     Running   <span style=color:#ae81ff>0</span>          2m46s
</span></span><span style=display:flex><span>vald-agent-ngt-2                       1/1     Running   <span style=color:#ae81ff>0</span>          2m46s
</span></span><span style=display:flex><span>vald-agent-ngt-3                       1/1     Running   <span style=color:#ae81ff>0</span>          2m46s
</span></span><span style=display:flex><span>vald-agent-ngt-4                       1/1     Running   <span style=color:#ae81ff>0</span>          2m46s
</span></span><span style=display:flex><span>vald-agent-ngt-5                       1/1     Running   <span style=color:#ae81ff>0</span>          2m46s
</span></span><span style=display:flex><span>vald-discoverer-879867b44-8m59h        1/1     Running   <span style=color:#ae81ff>0</span>          2m46s
</span></span><span style=display:flex><span>vald-lb-gateway-6c8c6b468d-ghlpx       1/1     Running   <span style=color:#ae81ff>0</span>          2m46s
</span></span><span style=display:flex><span>vald-lb-gateway-6c8c6b468d-rt688       1/1     Running   <span style=color:#ae81ff>0</span>          2m46s
</span></span><span style=display:flex><span>vald-lb-gateway-6c8c6b468d-jq7pl       1/1     Running   <span style=color:#ae81ff>0</span>          2m46s
</span></span><span style=display:flex><span>vald-manager-index-5596f89644-xfv4t    1/1     Running   <span style=color:#ae81ff>0</span>          2m46s
</span></span><span style=display:flex><span>vald-mirror-gateway-7b95956f8b-l57jz   1/1     Running   <span style=color:#ae81ff>0</span>          2m31s
</span></span><span style=display:flex><span>vald-mirror-gateway-7b95956f8b-xd9n5   1/1     Running   <span style=color:#ae81ff>0</span>          2m46s
</span></span><span style=display:flex><span>vald-mirror-gateway-7b95956f8b-dnxbb   1/1     Running   <span style=color:#ae81ff>0</span>          2m31s
</span></span></code></pre></div></details></li></ol><h2 id=deploy-valdmirrortarget-resource-custom-resource>Deploy ValdMirrorTarget Resource (Custom Resource)</h2><p>It requires applying the <code>ValdMirrorTarget</code> Custom Resource to the one Namespace.</p><p>When applied successfully, the destination information is automatically created on other Namespaces when interconnected with each <code>vald-mirror-gateway</code>.</p><p>This tutorial will deploy the <a href=https://github.com/vdaas/vald/blob/main/charts/vald/values/multi-vald/mirror-target.yaml>ValdMirrorTarget</a> Custom Resource to the <code>vald-03</code> Namespace with the following command.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f ./charts/vald/values/multi-vald/mirror-target.yaml -n vald-03
</span></span></code></pre></div><p>The current connection status can be checked with the following command.</p><details><summary>Example output</summary><br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get vmt -A -o wide
</span></span><span style=display:flex><span>NAMESPACE   NAME                                 HOST                                            PORT   STATUS      LAST TRANSITION TIME   AGE
</span></span><span style=display:flex><span>vald-03     mirror-target-01                     vald-mirror-gateway.vald-01.svc.cluster.local   <span style=color:#ae81ff>8081</span>   Connected   2023-05-22T02:07:51Z   19m
</span></span><span style=display:flex><span>vald-03     mirror-target-02                     vald-mirror-gateway.vald-02.svc.cluster.local   <span style=color:#ae81ff>8081</span>   Connected   2023-05-22T02:07:51Z   19m
</span></span><span style=display:flex><span>vald-02     mirror-target-3296010438411762394    vald-mirror-gateway.vald-01.svc.cluster.local   <span style=color:#ae81ff>8081</span>   Connected   2023-05-22T02:07:53Z   19m
</span></span><span style=display:flex><span>vald-02     mirror-target-12697587923462644654   vald-mirror-gateway.vald-03.svc.cluster.local   <span style=color:#ae81ff>8081</span>   Connected   2023-05-22T02:07:53Z   19m
</span></span><span style=display:flex><span>vald-01     mirror-target-13698925675968803691   vald-mirror-gateway.vald-02.svc.cluster.local   <span style=color:#ae81ff>8081</span>   Connected   2023-05-22T02:07:53Z   19m
</span></span><span style=display:flex><span>vald-01     mirror-target-17825710563723389324   vald-mirror-gateway.vald-03.svc.cluster.local   <span style=color:#ae81ff>8081</span>   Connected   2023-05-22T02:07:53Z   19m
</span></span></code></pre></div></details><h2 id=run-example-code>Run Example Code</h2><p>In this chapter, you will execute insert, search, get, and delete vectors to your Vald clusters using the example code.</p><p>The <a href=https://github.com/zalandoresearch/fashion-mnist>Fashion-MNIST</a> is used as a dataset for indexing and search query.</p><p>The example code is implemented in Go and uses <a href=https://github.com/vdaas/vald-client-go>vald-client-go</a>, one of the official Vald client libraries, for requesting to Vald cluster.</p><p>Vald provides multiple language client libraries such as Go, Java, Node.js, Python, etc.</p><p>If you are interested, please refer to <a href=https://vald.vdaas.org/docs/user-guides/sdks>SDKs</a>.</p><ol><li><p>Port Forward(option)</p><p>If you do NOT use Kubernetes Ingress, port forwarding is required to make requests from your local environment.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl port-forward svc/vald-mirror-gateway 8080:8081 -n vald-01 &amp; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  kubectl port-forward svc/vald-mirror-gateway 8081:8081 -n vald-02 &amp; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  kubectl port-forward svc/vald-mirror-gateway 8082:8081 -n vald-03
</span></span></code></pre></div></li><li><p>Download dataset</p><p>Move to the working directory.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd example/client/mirror
</span></span></code></pre></div><p>Download <a href=https://github.com/zalandoresearch/fashion-mnist>Fashion-MNIST</a>, which is used as a dataset for indexing and search query.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://ann-benchmarks.com/fashion-mnist-784-euclidean.hdf5
</span></span></code></pre></div></li><li><p>Run Example</p><p>We use <a href=https://github.com/vdaas/vald/blob/main/example/client/mirror/main.go>example/client/mirror/main.go</a> to run the example.</p><p>This example will insert and index 400 vectors into the Vald cluster from the Fashion-MNIST dataset via <a href=https://grpc.io/>gRPC</a>.
And then, after waiting for indexing, it will request to search the nearest vector 10 times to all Vald clusters. You will get the 10 nearest neighbor vectors for each search query.
And it will request to get vectors using inserted vector ID.</p><p>Run example codes by executing the below command.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go run main.go
</span></span></code></pre></div><p>See <a href=https://vald.vdaas.org/docs/tutorial/get-started/>GetStarted</a> for an explanation of the example code.</p></li></ol><h2 id=cleanup>Cleanup</h2><p>Last, you can remove the deployed Vald cluster by executing the below command.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm uninstall vald-cluster-01 -n vald-01 <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>helm uninstall vald-cluster-02 -n vald-02 <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>helm uninstall vald-cluster-03 -n vald-03
</span></span></code></pre></div><p>You can remove all <code>ValdMirrorTarget</code> resources (Custom Resource) with the below command.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete --all ValdMirrorTargets -A
</span></span></code></pre></div><p>You can remove all created Namespaces with the below command.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete namespaces vald-01 vald-02 vald-03
</span></span></code></pre></div><h2 id=next-steps>Next Steps</h2><p>Congratulation!
You completely entered the World of multiple Vald clusters!</p><p>For more information, we recommend you check the following:</p><ul><li><a href=https://vald.vdaas.org/docs/user-guides/configuration/>Configuration</a></li><li><a href=https://vald.vdaas.org/docs/user-guides/mirroring-configuration/>Mirror Configuration</a></li><li><a href=https://vald.vdaas.org/docs/user-guides/network-policy/>Network Policy</a></li></ul></div><aside class=current id=current><button class=menu><span class=dot></span></button><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#requirements>Requirements</a></li><li><a href=#prepare-the-kubernetes-cluster>Prepare the Kubernetes Cluster</a></li><li><a href=#deploy-vald-clusters-on-each-kubernetes-namespace>Deploy Vald Clusters on each Kubernetes Namespace</a></li><li><a href=#deploy-valdmirrortarget-resource-custom-resource>Deploy ValdMirrorTarget Resource (Custom Resource)</a></li><li><a href=#run-example-code>Run Example Code</a></li><li><a href=#cleanup>Cleanup</a></li><li><a href=#next-steps>Next Steps</a></li></ul></nav></aside></div></div></main><footer class=footer><div class=footer__content><ul class=footer__index><li class=footer__item><a href=/docs/v1.7/overview/about-vald class=footer__link>About<br></a></li><li class=footer__item><a href=/docs/v1.7/tutorial/get-started class=footer__link>Get Started<br></a></li><li class=footer__item><a href=/docs/v1.7/user-guides/sdks class=footer__link>SDKs</a></li><li class=footer__item><a href=/docs/v1.7 class=footer__link>Docs</a></li><li class=footer__item><a href=https://vdaas-vald.medium.com/ target=_blank class=footer__link>Blog<br></a></li></ul><ul class=footer__sns><li class=footer__item><a class="footer__item footer__icon" href=https://x.com/vdaas_vald target=_blank><picture><source srcset=https://vald.vdaas.org//images/logo_x_white.svg media="(prefers-color-scheme: dark)" class=icon__image width=24 height=24><img src=https://vald.vdaas.org//images/logo_x_black.svg alt=x class=icon__image></picture></a></li><li class=footer__item><a class="footer__item footer__icon" href=https://join.slack.com/t/vald-community/shared_invite/zt-db2ky9o4-R_9p2sVp8xRwztVa8gfnPA target=_blank><picture><source srcset=https://vald.vdaas.org//images/logo_slack_white.svg media="(prefers-color-scheme: dark)" class=icon__image width=24 height=24><img src=https://vald.vdaas.org//images/logo_slack_black.svg alt=slack class=icon__image></picture></a></li><li class=footer__item><a class="footer__item footer__icon" href=https://github.com/vdaas/vald target=_blank><picture><source srcset=https://vald.vdaas.org//images/logo_github_white.svg media="(prefers-color-scheme: dark)" class=icon__image width=24 height=24><img src=https://vald.vdaas.org//images/logo_github_black.svg alt=github class=icon__image></picture></a></li></ul></div><p class=footer__copylight>©2019-2024 vald.vdaas.org Vald team</p></footer></body></html>