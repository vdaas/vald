<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-F9Y0YKG55S"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F9Y0YKG55S")</script><link rel=canonical href=https://vald.vdaas.org><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=robots content='index, follow'><title>Vald | Agent</title>
<meta name=description content="Vald is high scalable distributed high-speed approximate nearest neighbor search engine" }><meta name=format-detection content="telephone=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta property="og:type" content="article"><meta property="og:title" content="Vald | Agent"><meta property="og:description" content="Vald is high scalable distributed high-speed approximate nearest neighbor search engine"><meta property="og:url" content="https://vald.vdaas.org/docs/v1.7/overview/component/agent/"><meta property="og:image" content="https://vald.vdaas.org//images/ogp_vald.png"><meta property="og:site_name" content="vald"><meta property="og:locale" content="en_US"><meta property="fb:app_id" content="615732422350002"><meta name=twitter:site content="@vdaas_vald"><meta name=twitter:card content="app"><link rel="shortcut icon" href=https://vald.vdaas.org//favicon.ico><link rel=stylesheet type=text/css href=/css/style.min.css><link rel=stylesheet type=text/css href=/css/header.min.css><link rel=stylesheet type=text/css href=/css/footer.min.css><link rel=stylesheet type=text/css href=/css/main.min.css><script type=text/javascript src=/js/script.min.js defer></script><meta name=viewport content="target-densitydpi=device-dpi,width=device-width,maximum-scale=1,user-scalable=yes"></head><body><header class=header id=header><div class=header__content><nav class=header__nav><a href=https://vald.vdaas.org/ class=header-nav__link><picture class=header-nav__image><source srcset=https://vald.vdaas.org//images/vald_white.svg media="(prefers-color-scheme: dark)"><img src=https://vald.vdaas.org//images/vald_color_1.svg alt>
</picture></a><a class=header-nav__icon id=nav-btn><span class=header-nav__button></span></a><ul class=header__list id=menu><li class=header__item><a href=/docs/v1.7/overview/about-vald class=header__link>About</a></li><li class=header__item><a href=/docs/v1.7/tutorial/get-started class=header__link>Get Started</a></li><li class=header__item><a href=/docs/v1.7/user-guides/sdks class=header__link>SDKs</a></li><li class=header__item><a href=/docs/v1.7 class=header__link>Docs</a></li><li class=header__item><a href=https://vdaas-vald.medium.com/ target=_blank class=header__link>Blog<br></a></li><li class=header__item><details class=header__version id=version_details><summary class=version__current id=current_version>v1.7</summary><ul class=version__list><il class=version__item><a href=javascript:void(0) class="version__link version__link--latest">v1.7.16</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.7</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.6</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.5</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.4</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.3</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.2</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.1</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.0</a></il></ul></details></li><li class=header__item><a class=header__git href=https://github.com/vdaas/vald target=_blank><picture class=git__logo><source srcset=https://vald.vdaas.org//images/logo_github_white.svg media="(prefers-color-scheme: dark)" width=18 height=18><img src=https://vald.vdaas.org//images/logo_github_black.svg alt=github width=18 height=18></picture><div class=git__star><p class=git__starnum id=git-star-num></p></div></a></li></ul></nav></div></header><main role=main><div class=single><aside class=page><nav><ul id=list-body><li class=withchild id=cat_Overview>Overview<ul><li class=index><a href=/docs/v1.7/overview/about-vald/>About Vald</a></li><li class=index><a href=/docs/v1.7/overview/architecture/>Architecture</a></li><li class=index><a href=/docs/v1.7/overview/data-flow/>Data Flow</a></li></ul></li><li class=withchild id=cat_Component>Component<ul><li class=view><a href=/docs/v1.7/overview/component/agent/>Agent</a></li><li class=index><a href=/docs/v1.7/overview/component/lb-gateway/>Lb Gateway</a></li><li class=index><a href=/docs/v1.7/overview/component/filter-gateway/>Filter Gateway</a></li><li class=index><a href=/docs/v1.7/overview/component/discoverer/>Discoverer</a></li><li class=index><a href=/docs/v1.7/overview/component/index-manager/>Index Manager</a></li><li class=index><a href=/docs/v1.7/overview/component/mirror-gateway/>Mirror Gateway</a></li></ul></li><li class=withchild id=cat_Tutorial>Tutorial<ul><li class=index><a href=/docs/v1.7/tutorial/get-started/>Get Started</a></li><li class=index><a href=/docs/v1.7/tutorial/get-started-with-faiss-agent/>Get Started With Faiss Agent</a></li><li class=index><a href=/docs/v1.7/tutorial/vald-agent-standalone-on-k8s/>Vald Agent Standalone on K8s</a></li><li class=index><a href=/docs/v1.7/tutorial/vald-agent-standalone-on-docker/>Vald Agent Standalone on Docker</a></li><li class=index><a href=/docs/v1.7/tutorial/vald-multicluster-on-k8s/>Vald Multicluster on K8s</a></li></ul></li><li class=withchild id=cat_Usecase>Usecase<ul><li class=index><a href=/docs/v1.7/usecase/usage-example/>Usage Example</a></li></ul></li><li class=withchild id="cat_User Guides">User Guides<ul><li class=index><a href=/docs/v1.7/user-guides/configuration/>Configuration</a></li><li class=index><a href=/docs/v1.7/user-guides/backup-configuration/>Backup Configuration</a></li><li class=index><a href=/docs/v1.7/user-guides/filtering-configuration/>Filtering Configuration</a></li><li class=index><a href=/docs/v1.7/user-guides/mirroring-configuration/>Mirroring Configuration</a></li><li class=index><a href=/docs/v1.7/user-guides/cluster-role-binding/>Cluster Role Binding</a></li><li class=index><a href=/docs/v1.7/user-guides/deployment/>Deployment</a></li><li class=index><a href=/docs/v1.7/user-guides/operations/>Operations</a></li><li class=index><a href=/docs/v1.7/user-guides/upgrade-cluster/>Upgrade Cluster</a></li><li class=index><a href=/docs/v1.7/user-guides/capacity-planning/>Capacity Planning</a></li><li class=index><a href=/docs/v1.7/user-guides/client-api-config/>Client Api Config</a></li><li class=index><a href=/docs/v1.7/user-guides/observability-configuration/>Observability Configuration</a></li><li class=index><a href=/docs/v1.7/user-guides/network-policy/>Network Policy</a></li><li class=index><a href=/docs/v1.7/user-guides/index-correction/>Index Correction</a></li><li class=index><a href=/docs/v1.7/user-guides/sdks/>Sdks</a></li><li class=index><a href=/docs/v1.7/user-guides/read-replica-and-rotator/>Read Replica and Rotator</a></li></ul></li><li class=withchild id=cat_Performance>Performance<ul><li class=index><a href=/docs/v1.7/performance/benchmark/>Benchmark</a></li><li class=index><a href=/docs/v1.7/performance/loadtest/>Loadtest</a></li><li class=index><a href=/docs/v1.7/performance/continuous-benchmark/>Continuous Benchmark</a></li><li class=index><a href=/docs/v1.7/performance/tuning-search-performance/>Tuning Search Performance</a></li></ul></li><li class=withchild id=cat_Api>API<ul><li class=index><a href=/docs/v1.7/api/insert/>Insert</a></li><li class=index><a href=/docs/v1.7/api/update/>Update</a></li><li class=index><a href=/docs/v1.7/api/upsert/>Upsert</a></li><li class=index><a href=/docs/v1.7/api/search/>Search</a></li><li class=index><a href=/docs/v1.7/api/remove/>Remove</a></li><li class=index><a href=/docs/v1.7/api/flush/>Flush</a></li><li class=index><a href=/docs/v1.7/api/object/>Object</a></li><li class=index><a href=/docs/v1.7/api/filter-gateway/>Filter Gateway</a></li><li class=index><a href=/docs/v1.7/api/mirror-gateway/>Mirror Gateway</a></li><li class=index><a href=/docs/v1.7/api/status/>Status</a></li><li class=index><a href=/docs/v1.7/api/build_proto/>Build</a></li></ul></li><li class=withchild id=cat_Troubleshooting>Troubleshooting<ul><li class=index><a href=/docs/v1.7/troubleshooting/client-side/>Client Side</a></li><li class=index><a href=/docs/v1.7/troubleshooting/provisioning/>Provisioning</a></li><li class=index><a href=/docs/v1.7/troubleshooting/mirror-gateway/>Mirror Gateway</a></li></ul></li><li class=withchild id=cat_Contributing>Contributing<ul><li class=index><a href=/docs/v1.7/contributing/contributing-guide/>Contributing Guide</a></li><li class=index><a href=/docs/v1.7/contributing/development/>Development</a></li><li class=index><a href=/docs/v1.7/contributing/coding-style/>Coding Style</a></li><li class=index><a href=/docs/v1.7/contributing/unit-test-guideline/>Unit Test Guideline</a></li><li class=index><a href=/docs/v1.7/contributing/reviewer-guideline/>Reviewer Guideline</a></li></ul></li><li class=withchild id=cat_Support>Support<ul><li class=index><a href=/docs/v1.7/support/contacts/>Contacts</a></li><li class=index><a href=/docs/v1.7/support/faq/>FAQ</a></li></ul></li><li class=withchild id=cat_Release>Release<ul><li class=index><a href=/docs/v1.7/release/changelog/>Changelog</a></li></ul></li></ul></nav></aside><div class=content><div class=markdown id=markdown><h1 id=vald-agent>Vald Agent</h1><p>Vald Agent is the core component of the Vald cluster.</p><p>Mainly, it consists of 1 or 2 small components, Vald Core and Vald Agent sidecar, depending on the use case.</p><p>This page introduces the overview and features of Vald Agent.</p><h2 id=responsibility>Responsibility</h2><p>Vald Agent is responsible for:</p><ul><li>Store index data along to the user requests<ul><li>The store destination is In-Memory, Volume Mounts, Persistent Volume, or External Storage.</li></ul></li><li>Search the nearest neighbor vectors of the request vector and return the search result</li></ul><h2 id=features>Features</h2><p>Vald Agent has two components, <code>core</code> and <code>sidecar</code>.</p><p>This chapter shows the characteristics of each small component.</p><h3 id=core>Core</h3><p><code>Core</code> is responsible for the main features of Vald Agent.</p><p>It uses a specific algorithm, and you can choose one algorithm depending on your needs.</p><p>Vald provides:</p><ul><li>Vald Agent NGT</li></ul><p>as core algorithm layer.</p><h4 id=vald-agent-ngt>Vald Agent NGT</h4><p>Vald Agent NGT uses <a href=https://github.com/yahoojapan/NGT>NGT</a> as an algorithm.</p><p>The main functions are the followings:</p><ul><li>Insert<ul><li>Request to insert new vectors into the NGT.</li><li>Requested vectors are stored in the <code>vqueue</code>.</li></ul></li><li>Search<ul><li>Get the nearest neighbor vectors of the request vector from NGT indexes.</li></ul></li><li>Update<ul><li>Create a request to update the specific vectors to the new vectors.</li><li>Requested vectors are stored in the <code>vqueue</code>.</li></ul></li><li>Remove<ul><li>Create a request to remove the specific vectors from NGT indexes.</li><li>Requested vectors are stored in the <code>vqueue</code>.</li></ul></li><li>GetObject<ul><li>Get the information on the indexed vectors.</li></ul></li><li>Exist<ul><li>Check whether the specific vectors are already inserted or not.</li></ul></li><li>CreateIndex<ul><li>Create a new NGT index structure in memory using vectors stored in the <code>vqueue</code> and the existing NGT index structure if it exists.</li></ul></li><li>SaveIndex<ul><li>Save metadata about NGT index information to the internal storage.</li></ul></li></ul><div class=notice>You have to control the duration of CreateIndex and SaveIndex by configuration.<p>These methods don’t always run when getting the request.</p></div><div class=warning>As you see, Vald Agent NGT can only search the nearest neighbors from the NGT index.<p>You have to wait to complete the CreateIndex and SaveIndex functions before searching.</p></div><p>This image shows the mechanism to create NGT index.</p><img src=/images/v1.7/overview/component/agent/ngt.png alt="NGT Index Creation Mechanism"><p>Please refer to <a href=https://pkg.go.dev/github.com/vdaas/vald@v1.7.16/pkg/agent/core/ngt/service>Go Doc</a> for other functions.</p><h4 id=vald-agent-faiss>Vald Agent Faiss</h4><p>Vald Agent Faiss uses <a href=https://github.com/facebookresearch/faiss>Faiss</a> as an algorithm.</p><p>The main functions are the followings:</p><ul><li>Insert<ul><li>Request to insert new vectors into the Faiss.</li><li>Requested vectors are stored in the <code>vqueue</code>.</li><li>Cache a fixed number of verctors for Faiss training.</li><li>Once Faiss trained in CreateIndex, the vector is never cached for Faiss training.</li></ul></li><li>Search<ul><li>Get the nearest neighbor vectors of the request vector from Faiss indexes.</li><li>radius/epsilon is search config for NGT and has no meaning in Faiss.</li></ul></li><li>Update<ul><li>Create a request to update the specific vectors to the new vectors.</li><li>Requested vectors are stored in the <code>vqueue</code>.</li></ul></li><li>Remove<ul><li>Create a request to remove the specific vectors from Faiss indexes.</li><li>Requested vectors are stored in the <code>vqueue</code>.</li></ul></li><li>Exist<ul><li>Check whether the specific vectors are already inserted or not.</li></ul></li><li>CreateIndex<ul><li>Create a new Faiss index structure in memory using vectors stored in the <code>vqueue</code> and the existing Faiss index structure if it exists.</li><li>If a certain number of vectors required for Faiss training are not cached, they will not be trained.</li><li>If Faiss is not trained, no index is generated.</li></ul></li><li>SaveIndex<ul><li>Save metadata about Faiss index information to the internal storage.</li></ul></li></ul><p>Unimplemented functions are the followings:</p><ul><li>GetObject</li><li>SearchByID</li><li>StreamXXX</li><li>MultiXXX</li></ul><div class=notice>Same as Agent NGT, You have to control the duration of CreateIndex and SaveIndex by configuration.<p>These methods don’t always run when getting the request.</p></div><div class=warning>As you see, Vald Agent Faiss can only search the nearest neighbors from the Faiss index.<p>You have to wait to complete the CreateIndex and SaveIndex functions before searching.</p></div><h3 id=sidecar>Sidecar</h3><p><code>Sidecar</code> saves the index metadata file to external storage like Amazon S3 or Google Cloud Storage.</p><p>The main functions are:</p><ul><li>Backup<ul><li>When <code>Agent Core</code> completes creating the index metadata files, <code>Sidecar</code> hooks to store them in the external storage.</li></ul></li></ul><img src=/images/v1.7/overview/component/agent/sidecar_backup.png><ul><li>Restore<ul><li>When the Vald Agent Pod restarts, the index structure is restored from the external backup files.</li></ul></li></ul><img src=/images/v1.7/overview/component/agent/sidecar_restore.png></div><aside class=current id=current><button class=menu><span class=dot></span></button><nav id=TableOfContents><ul><li><a href=#responsibility>Responsibility</a></li><li><a href=#features>Features</a><ul><li><a href=#core>Core</a></li><li><a href=#sidecar>Sidecar</a></li></ul></li></ul></nav></aside></div></div></main><footer class=footer><div class=footer__content><ul class=footer__index><li class=footer__item><a href=/docs/v1.7/overview/about-vald class=footer__link>About<br></a></li><li class=footer__item><a href=/docs/v1.7/tutorial/get-started class=footer__link>Get Started<br></a></li><li class=footer__item><a href=/docs/v1.7/user-guides/sdks class=footer__link>SDKs</a></li><li class=footer__item><a href=/docs/v1.7 class=footer__link>Docs</a></li><li class=footer__item><a href=https://vdaas-vald.medium.com/ target=_blank class=footer__link>Blog<br></a></li></ul><ul class=footer__sns><li class=footer__item><a class="footer__item footer__icon" href=https://x.com/vdaas_vald target=_blank><picture><source srcset=https://vald.vdaas.org//images/logo_x_white.svg media="(prefers-color-scheme: dark)" class=icon__image width=24 height=24><img src=https://vald.vdaas.org//images/logo_x_black.svg alt=x class=icon__image></picture></a></li><li class=footer__item><a class="footer__item footer__icon" href=https://join.slack.com/t/vald-community/shared_invite/zt-db2ky9o4-R_9p2sVp8xRwztVa8gfnPA target=_blank><picture><source srcset=https://vald.vdaas.org//images/logo_slack_white.svg media="(prefers-color-scheme: dark)" class=icon__image width=24 height=24><img src=https://vald.vdaas.org//images/logo_slack_black.svg alt=slack class=icon__image></picture></a></li><li class=footer__item><a class="footer__item footer__icon" href=https://github.com/vdaas/vald target=_blank><picture><source srcset=https://vald.vdaas.org//images/logo_github_white.svg media="(prefers-color-scheme: dark)" class=icon__image width=24 height=24><img src=https://vald.vdaas.org//images/logo_github_black.svg alt=github class=icon__image></picture></a></li></ul></div><p class=footer__copylight>©2019-2025 vald.vdaas.org Vald team</p></footer></body></html>