<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-F9Y0YKG55S"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F9Y0YKG55S")</script><link rel=canonical href=https://vald.vdaas.org><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=robots content="index, follow"><title>Vald | Deployment</title>
<meta name=description content="Vald is high scalable distributed high-speed approximate nearest neighbor search engine" }><meta name=format-detection content="telephone=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta property="og:type" content="article"><meta property="og:title" content="Vald | Deployment"><meta property="og:description" content="Vald is high scalable distributed high-speed approximate nearest neighbor search engine"><meta property="og:url" content="https://vald.vdaas.org/docs/v1.7/user-guides/deployment/"><meta property="og:image" content="https://vald.vdaas.org/images/ogp_vald.png"><meta property="og:site_name" content="vald"><meta property="og:locale" content="en_US"><meta property="fb:app_id" content="615732422350002"><meta name=twitter:site content="@vdaas_vald"><meta name=twitter:card content="app"><link rel="shortcut icon" href=https://vald.vdaas.org/favicon.ico><link rel=stylesheet type=text/css href=/css/style.min.css><link rel=stylesheet type=text/css href=/css/header.min.css><link rel=stylesheet type=text/css href=/css/footer.min.css><link rel=stylesheet type=text/css href=/css/main.min.css><script type=text/javascript src=/js/script.min.js defer></script><meta name=viewport content="target-densitydpi=device-dpi,width=device-width,maximum-scale=1,user-scalable=yes"></head><body><header class=header id=header><div class=header__content><nav class=header__nav><a href=https://vald.vdaas.org class=header-nav__link><picture class=header-nav__image><source srcset=https://vald.vdaas.org/images/vald_white.svg media="(prefers-color-scheme: dark)"><img src=https://vald.vdaas.org/images/vald_color_1.svg alt>
</picture></a><a class=header-nav__icon id=nav-btn><span class=header-nav__button></span></a><ul class=header__list id=menu><li class=header__item><a href=/docs/v1.7/overview/about-vald class=header__link>About</a></li><li class=header__item><a href=/docs/v1.7/tutorial/get-started class=header__link>Get Started</a></li><li class=header__item><a href=/docs/v1.7/user-guides/sdks class=header__link>SDKs</a></li><li class=header__item><a href=/docs/v1.7 class=header__link>Docs</a></li><li class=header__item><a href=https://vdaas-vald.medium.com/ target=_blank class=header__link>Blog<br></a></li><li class=header__item><details class=header__version id=version_details><summary class=version__current id=current_version>v1.7</summary><ul class=version__list><il class=version__item><a href=javascript:void(0) class="version__link version__link--latest">v1.7.9</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.7</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.6</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.5</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.4</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.3</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.2</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.1</a></il>
<il class=version__item><a href=javascript:void(0) class=version__link>v1.0</a></il></ul></details></li><li class=header__item><a class=header__git href=https://github.com/vdaas/vald target=_blank><picture class=git__logo><source srcset=https://vald.vdaas.org/images/logo_github_white.svg media="(prefers-color-scheme: dark)" width=18 height=18><img src=https://vald.vdaas.org/images/logo_github_black.svg alt=github width=18 height=18></picture><div class=git__star><p class=git__starnum id=git-star-num></p></div></a></li></ul></nav></div></header><main role=main><div class=single><aside class=page><nav><ul id=list-body><li class=withchild id=cat_Overview>Overview<ul><li class=index><a href=/docs/v1.7/overview/about-vald/>About Vald</a></li><li class=index><a href=/docs/v1.7/overview/architecture/>Architecture</a></li><li class=index><a href=/docs/v1.7/overview/data-flow/>Data Flow</a></li></ul></li><li class=withchild id=cat_Component>Component<ul><li class=index><a href=/docs/v1.7/overview/component/agent/>Agent</a></li><li class=index><a href=/docs/v1.7/overview/component/lb-gateway/>Lb Gateway</a></li><li class=index><a href=/docs/v1.7/overview/component/filter-gateway/>Filter Gateway</a></li><li class=index><a href=/docs/v1.7/overview/component/discoverer/>Discoverer</a></li><li class=index><a href=/docs/v1.7/overview/component/index-manager/>Index Manager</a></li></ul></li><li class=withchild id=cat_Tutorial>Tutorial<ul><li class=index><a href=/docs/v1.7/tutorial/get-started/>Get Started</a></li><li class=index><a href=/docs/v1.7/tutorial/vald-agent-standalone-on-k8s/>Vald Agent Standalone on K8s</a></li><li class=index><a href=/docs/v1.7/tutorial/vald-agent-standalone-on-docker/>Vald Agent Standalone on Docker</a></li></ul></li><li class=withchild id=cat_Usecase>Usecase<ul><li class=index><a href=/docs/v1.7/usecase/usage-example/>Usage Example</a></li></ul></li><li class=withchild id="cat_User Guides">User Guides<ul><li class=index><a href=/docs/v1.7/user-guides/configuration/>Configuration</a></li><li class=index><a href=/docs/v1.7/user-guides/backup-configuration/>Backup Configuration</a></li><li class=index><a href=/docs/v1.7/user-guides/filtering-configuration/>Filtering Configuration</a></li><li class=index><a href=/docs/v1.7/user-guides/cluster-role-binding/>Cluster Role Binding</a></li><li class=view><a href=/docs/v1.7/user-guides/deployment/>Deployment</a></li><li class=index><a href=/docs/v1.7/user-guides/operations/>Operations</a></li><li class=index><a href=/docs/v1.7/user-guides/upgrade-cluster/>Upgrade Cluster</a></li><li class=index><a href=/docs/v1.7/user-guides/capacity-planning/>Capacity Planning</a></li><li class=index><a href=/docs/v1.7/user-guides/client-api-config/>Client Api Config</a></li><li class=index><a href=/docs/v1.7/user-guides/network-policy/>Network Policy</a></li><li class=index><a href=/docs/v1.7/user-guides/index-correction/>Index Correction</a></li><li class=index><a href=/docs/v1.7/user-guides/sdks/>Sdks</a></li><li class=index><a href=/docs/v1.7/user-guides/observability-configuration/>Observability Configuration</a></li></ul></li><li class=withchild id=cat_Performance>Performance<ul><li class=index><a href=/docs/v1.7/performance/loadtest/>Loadtest</a></li><li class=index><a href=/docs/v1.7/performance/benchmark/>Benchmark</a></li></ul></li><li class=withchild id=cat_Api>API<ul><li class=index><a href=/docs/v1.7/api/insert/>Insert</a></li><li class=index><a href=/docs/v1.7/api/update/>Update</a></li><li class=index><a href=/docs/v1.7/api/upsert/>Upsert</a></li><li class=index><a href=/docs/v1.7/api/search/>Search</a></li><li class=index><a href=/docs/v1.7/api/remove/>Remove</a></li><li class=index><a href=/docs/v1.7/api/object/>Object</a></li><li class=index><a href=/docs/v1.7/api/filter-gateway/>Filter Gateway</a></li><li class=index><a href=/docs/v1.7/api/status/>Status</a></li><li class=index><a href=/docs/v1.7/api/build_proto/>Build Proto</a></li></ul></li><li class=withchild id=cat_Troubleshooting>Troubleshooting<ul><li class=index><a href=/docs/v1.7/troubleshooting/provisioning/>Provisioning</a></li><li class=index><a href=/docs/v1.7/troubleshooting/client-side/>Client Side</a></li></ul></li><li class=withchild id=cat_Contributing>Contributing<ul><li class=index><a href=/docs/v1.7/contributing/contributing-guide/>Contributing Guide</a></li><li class=index><a href=/docs/v1.7/contributing/development/>Development</a></li><li class=index><a href=/docs/v1.7/contributing/coding-style/>Coding Style</a></li><li class=index><a href=/docs/v1.7/contributing/unit-test-guideline/>Unit Test Guideline</a></li></ul></li><li class=withchild id=cat_Support>Support<ul><li class=index><a href=/docs/v1.7/support/contacts/>Contacts</a></li><li class=index><a href=/docs/v1.7/support/faq/>Faq</a></li></ul></li><li class=withchild id=cat_Release>Release<ul><li class=index><a href=/docs/v1.7/release/changelog/>Changelog</a></li></ul></li></ul></nav></aside><div class=content><div class=markdown id=markdown><h1 id=deployment>Deployment</h1><p>There are two major ways for the deployment of the Vald cluster ways: Using the Helm command with <code>values.yaml</code> or without Helm command using operator called <code>vald-helm-operator</code>.</p><ul><li><p>Using Helm command with <code>values.yaml</code></p><ul><li>Easy to deploy</li><li>Allow editing Vald configuration values when the user executes Helm command with inlining.</li><li>Need Helm command when applying configuration</li></ul></li><li><p>Using <code>vald-helm-operator</code></p><ul><li>Monitoring the Vald deployments and Vald custom resource by <code>vald-helm-operator</code></li><li>Use <code>kubectl</code> command to set or update of the Vald cluster configuration</li><li>Automate manage the Vald cluster based on CRD (Custom Resource Definitions)</li></ul></li></ul><div class=notice>The benefit of using vald-helm-operator, it eliminates the need to check the status of the Vald cluster from the Vald cluster operator.
It manages the Vald cluster based on the designed configuration instead of you.</div><h2 id=requirement>Requirement</h2><ul><li>Helm: v3 ~</li></ul><p>If Helm is not installed, please install <a href=https://helm.sh/docs/intro/install>Helm</a>.</p><details><summary>Installation command for Helm</summary><br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
</span></span></code></pre></div></details><h2 id=before-deployment>Before Deployment</h2><p>Both ways need the configuration file when you need to overwrite the default configurations before the deployment.</p><p>Please refer to <a href=/docs/v1.7/user-guides/configuration>the basic configuration document</a>.</p><p>In addition, as you need, please refer to the followings:</p><ul><li><a href=/docs/v1.7/user-guides/backup-configuration>Backup Configuration</a></li><li><a href=/docs/v1.7/user-guides/filtering-configuration>Filter Configuration</a></li></ul><p>Moreover, we publish the example configuration files for each use case.
Please also refer to <a href=https://github.com/vdaas/vald/tree/main/charts/vald/values>here</a>.</p><h2 id=use-helm-command>Use Helm command</h2><h3 id=deployment-1>Deployment</h3><p>When deploying with Helm command, it requires <code>value.yaml</code> to override the default values.</p><details><summary>Sample values YAML</summary><br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>defaults</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>logging</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>level</span>: <span style=color:#ae81ff>debug</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>image</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Please set the specified version, e.g., v1.5.6, instead of latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tag</span>: <span style=color:#e6db74>&#34;latest&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>server_config</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>healths</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>liveness</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>livenessProbe</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>readiness</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>readinessProbe</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>## vald-lb-gateway settings</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>gateway</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>lb</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>minReplicas</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>maxReplicas</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>gateway_config</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>index_replica</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>## vald-agent settings</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>agent</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>minReplicas</span>: <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>maxReplicas</span>: <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>podManagementPolicy</span>: <span style=color:#ae81ff>Parallel</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ngt</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>dimension</span>: <span style=color:#ae81ff>784</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>distance_type</span>: <span style=color:#ae81ff>l2</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>object_type</span>: <span style=color:#ae81ff>float</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># When auto_index_check_duration_limit is minus value, the agent auto indexing is effectively disabled.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>auto_index_check_duration_limit</span>: <span style=color:#e6db74>&#34;-1s&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># When auto_index_duration_limit is minus value, the agent auto indexing is effectively disabled.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>auto_index_duration_limit</span>: <span style=color:#e6db74>&#34;-1s&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>auto_create_index_pool_size</span>: <span style=color:#ae81ff>10000</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>default_pool_size</span>: <span style=color:#ae81ff>10000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>## vald-discoverer settings</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>discoverer</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>150m</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>50Mi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>## vald-manager settings</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>manager</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>index</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>150m</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>30Mi</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>indexer</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>auto_index_duration_limit</span>: <span style=color:#ae81ff>1m</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>auto_index_check_duration</span>: <span style=color:#ae81ff>40s</span>
</span></span></code></pre></div></details><p>After create <code>values.yaml</code>, you can deploy by the following steps.</p><ol><li><p>Add vald repo into the helm repo.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add vald https://vdaas.vald.org/charts
</span></span></code></pre></div></li><li><p>Deploy with the <code>values.yaml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install vald vald/vald --values &lt;YOUR VALUES YAML FILE PATH&gt;
</span></span></code></pre></div></li></ol><h3 id=update-configuration>Update Configuration</h3><p>When you need to update the configuration, you can update by following command with your new <code>values.yaml</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm upgrate vald vald/vald --values &lt;YOUR NEW VALUES FILE PATH&gt;
</span></span></code></pre></div><h3 id=cleanup>Cleanup</h3><p>The Vald cluster can be removed by the following command.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm uninstall vald
</span></span></code></pre></div><div class=caution>If using PV for the backup, PV won't delete automatically.</div><h2 id=using-with-vald-helm-operator>Using with vald-helm-operator</h2><h3 id=deployment-2>Deployment</h3><p>When deploying with vald-helm-operator, it requires <code>vr.yaml</code> file for applying <code>ValdRelease</code>.
<code>vald-helm-operator</code> manages the Vald cluster based on configuration of <code>vr.yaml</code>.</p><details><summary>Sample ValdRelease YAML</summary><br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>vald.vdaas.org/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ValdRelease</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>vald-cluster</span>
</span></span><span style=display:flex><span><span style=color:#75715e># the values of Helm chart for Vald can be placed under the `spec` field.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>defaults</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>logging</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>level</span>: <span style=color:#ae81ff>debug</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>:
</span></span><span style=display:flex><span>      <span style=color:#75715e># Please set the specified version, e.g., v1.5.6, instead of latest</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>tag</span>: <span style=color:#e6db74>&#34;latest&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_config</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>healths</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>liveness</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>livenessProbe</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>readiness</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>readinessProbe</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>## vald-lb-gateway settings</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>gateway</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>lb</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>minReplicas</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>maxReplicas</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>gateway_config</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>index_replica</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>## vald-agent settings</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>agent</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>minReplicas</span>: <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>maxReplicas</span>: <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>podManagementPolicy</span>: <span style=color:#ae81ff>Parallel</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ngt</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>dimension</span>: <span style=color:#ae81ff>784</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>distance_type</span>: <span style=color:#ae81ff>l2</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>object_type</span>: <span style=color:#ae81ff>float</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># When auto_index_check_duration_limit is minus value, the agent auto indexing is effectively disabled.</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>auto_index_check_duration_limit</span>: <span style=color:#e6db74>&#34;-1s&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># When auto_index_duration_limit is minus value, the agent auto indexing is effectively disabled.</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>auto_index_duration_limit</span>: <span style=color:#e6db74>&#34;-1s&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>auto_create_index_pool_size</span>: <span style=color:#ae81ff>10000</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>default_pool_size</span>: <span style=color:#ae81ff>10000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>## vald-discoverer settings</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>discoverer</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>150m</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>50Mi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>## vald-manager settings</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>manager</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>index</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>150m</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>30Mi</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>indexer</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>auto_index_duration_limit</span>: <span style=color:#ae81ff>1m</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>auto_index_check_duration</span>: <span style=color:#ae81ff>40s</span>
</span></span></code></pre></div></details><p>In addition, you can use the operator for the <code>vald-helm-operator</code> by applying <code>vhor.yaml</code> for <code>ValdHelmOperatorRelease</code>.
It is possible to auto-managing vald-helm-operator.</p><details><summary>Sample ValdHelmOperatorRelease YAML</summary><br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>vald.vdaas.org/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ValdHelmOperatorRelease</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>vald-helm-operator-release</span>
</span></span><span style=display:flex><span><span style=color:#75715e># the values of Helm chart for vald-helm-operator can be placed under the `spec` field.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>watchNamespaces</span>: <span style=color:#e6db74>&#34;default&#34;</span>
</span></span></code></pre></div></details><p>For more details of the configuration of vald-helm-operator-release, please refer to <a href=https://github.com/vdaas/vald/tree/main/charts/vald-helm-operator#configuration>here</a>.</p><p>After setting <code>vr.yaml</code> (and <code>vhor.yaml</code>), you can deploy by the following steps.</p><div class=warning>If you need to deploy ValdHelmOperatorRelease, you should apply vhor.yaml before applying vr.yaml.</div><ol><li><p>Add vald repo into the helm repo</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add vald https://vdaas.vald.org
</span></span></code></pre></div></li><li><p>Deploy <code>vald-helm-operator</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install vald-helm-operator-release vald/vald-helm-operator
</span></span></code></pre></div></li><li><p>Apply <code>vhor.yaml</code> (optional)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f vhor.yaml
</span></span></code></pre></div><p>After deployment success, the Kubernetes cluster runs the rolling update for vald-helm-operator components.</p></li><li><p>Apply <code>vr.yaml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f vr.yaml
</span></span></code></pre></div></li></ol><h3 id=update-configuration-1>Update Configuration</h3><p>When you need to update the configuration, you can update by following command with your new <code>vr.yaml</code> or <code>vhor.yaml</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f &lt;new vr.yaml or new vhor.yaml&gt;
</span></span></code></pre></div><h3 id=cleanup-1>Cleanup</h3><p>The Vald cluster can be removed by the following steps.</p><ol><li><p>Delete the <code>ValdRelease</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete -f vr.yaml
</span></span></code></pre></div></li><li><p>Delete the <code>ValdHelmOperatorReleases</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete -f vhor.yaml
</span></span></code></pre></div></li><li><p>Delete crd</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl patch crd/valdhelmopratorreleases.vald.vdaas.org -p <span style=color:#e6db74>&#39;{&#34;metadata&#34;:{&#34;finalizers&#34;:[]}}&#39;</span> -type<span style=color:#f92672>=</span>merge
</span></span></code></pre></div></li></ol><div class=notice>If using PV for the backup, PV won't delete automatically.</div></div><aside class=current id=current><button class=menu><span class=dot></span></button><nav id=TableOfContents><ul><li><a href=#requirement>Requirement</a></li><li><a href=#before-deployment>Before Deployment</a></li><li><a href=#use-helm-command>Use Helm command</a><ul><li><a href=#deployment-1>Deployment</a></li><li><a href=#update-configuration>Update Configuration</a></li><li><a href=#cleanup>Cleanup</a></li></ul></li><li><a href=#using-with-vald-helm-operator>Using with vald-helm-operator</a><ul><li><a href=#deployment-2>Deployment</a></li><li><a href=#update-configuration-1>Update Configuration</a></li><li><a href=#cleanup-1>Cleanup</a></li></ul></li></ul></nav></aside></div></div></main><footer class=footer><div class="footer__content cf"><ul class=footer__list><li class=footer__item><a href=/docs/v1.7/overview/about-vald class=footer__link>About<br></a></li><li class=footer__item><a href=/docs/v1.7/tutorial/get-started class=footer__link>Get Started<br></a></li><li class=footer__item><a href=/docs/v1.7/user-guides/sdks class=footer__link>SDKs</a></li><li class=footer__item><a href=/docs/v1.7 class=footer__link>Docs</a></li><li class=footer__item><a href=https://vdaas-vald.medium.com/ target=_blank class=footer__link>Blog<br></a></li><li class=footer__item><a class="footer__item footer__icon" href=https://github.com/vdaas/vald target=_blank><picture><source srcset=https://vald.vdaas.org/images/logo_github_white.svg media="(prefers-color-scheme: dark)" class=icon__image width=24 height=24><img src=https://vald.vdaas.org/images/logo_github_black.svg alt=github class=icon__image></picture></a></li></ul></div><p class=footer__copylight>Â©2019-2023 vald.vdaas.org Vald team</p></footer></body></html>