<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>Backup configuration</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

/* From extension marp-team.marp-vscode */
#__marp-vscode {
  all: revert;
}

/* Override VS Code default CSS rules reverting to initial
   https://github.com/microsoft/vscode/blob/master/src/vs/workbench/contrib/webview/browser/pre/main.js#L53 */
body.marp-vscode {
  padding: 0;
}

body.marp-vscode img {
  max-width: unset;
  max-height: unset;
}

body.marp-vscode a,
body.marp-vscode a:hover,
body.marp-vscode code {
  color: unset;
}

body.marp-vscode blockquote {
  background: unset;
  border-color: unset;
}

@media screen {
  body.marp-vscode {
    overflow-y: scroll;

    /* stylelint-disable-next-line selector-class-pattern */
    &.showEditorSelection {
      --marp-vscode-highlight-color: rgb(255 255 255 / 40%);

      &.vscode-light {
        --marp-vscode-highlight-color: rgb(0 0 0 / 15%);
      }

      &.vscode-high-contrast {
        --marp-vscode-highlight-color: rgb(255 160 0 / 70%);
      }
    }
  }

  #__marp-vscode [data-marp-vscode-slide-wrapper] {
    margin: 20px;
    position: relative;

    &.code-active-line,
    &:has(.code-active-line) {
      &::before {
        position: absolute;
        content: '';
        inset: -7px;
        border: 3px solid var(--marp-vscode-highlight-color, transparent);
        pointer-events: none;
      }
    }
  }

  #__marp-vscode svg[data-marpit-svg] {
    box-shadow: 0 5px 10px rgb(0 0 0 / 25%);
    display: block;
    margin: 0;
  }

  /* Based on https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
  #code-csp-warning {
    background-color: #444;
    box-shadow: 1px 1px 1px rgb(0 0 0 / 25%);
    color: white;
    cursor: pointer;
    font-family: sans-serif;
    font-size: 12px;
    line-height: 22px;
    margin: 16px;
    padding: 6px;
    position: fixed;
    right: 0;
    text-align: center;
    top: 0;
    word-wrap: break-word;
  }

  #code-csp-warning:hover {
    text-decoration: none;
    background-color: #007acc;
    box-shadow: 2px 2px 2px rgb(0 0 0 / 25%);
  }
}

@media print {
  body.marp-vscode #code-csp-warning {
    display: none;
  }
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="backup-configuration">Backup configuration</h1>
<p>There are three types of options for the Vald cluster: backup, filtering, and core algorithms.</p>
<p>This page describes how to enable the backup feature on your Vald cluster.</p>
<h2 id="what-is-the-backup">What is the backup</h2>
<p>Vald's backup function is to save the index data in each Vald Agent pod as a data file to the Persistent Volume or S3.
When the Vald Agent pod is restarted for some reason, the index state is restored from the saved index data.</p>
<h2 id="backup-methods">Backup methods</h2>
<p>You can choose one of three types of backup methods.</p>
<ul>
<li>PV (recommended)</li>
<li>S3</li>
<li>PV + S3</li>
</ul>
<p>Please refer to the following tables and decide which method fit for your case.</p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">PV</th>
<th style="text-align:left">S3</th>
<th style="text-align:left">PV+S3</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">usecase</td>
<td style="text-align:left">Want to use backup with low cost<BR>Would not like to use some external storage for backup<BR>Want to backup with highly compatible storage with Kubernetes</td>
<td style="text-align:left">Want to use the same backup file with several Vald clusters<BR>Want to access the backup files easily</td>
<td style="text-align:left">Want to use backup with PV basically and access the backup files easily<BR>Want to prevent backup file failure due to Kubernetes cluster failure</td>
</tr>
<tr>
<td style="text-align:left">pros :+1:</td>
<td style="text-align:left">Easy to use<BR>Highly compatible with Kubernetes<BR>Low latency using in-cluster network<BR>Safety backup using Copy on Write option</td>
<td style="text-align:left">Easy to access backup files<BR>It can be shared and used by multiple clusters</td>
<td style="text-align:left">The safest of these methods</td>
</tr>
<tr>
<td style="text-align:left">cons :-1:</td>
<td style="text-align:left">A bit hard to check backup files<BR>Can not share backup files for several Vald clusters</td>
<td style="text-align:left">Need to communicate with external network</td>
<td style="text-align:left">Need to operate both storages<BR>The most expensive way</td>
</tr>
</tbody>
</table>
<h2 id="backup-configuration-1">Backup configuration</h2>
<p>This section shows the best practice for configuring backup features with PV, S3, or PV + S3.</p>
<p>Each sample configuration yaml is published on <a href="https://github.com/vdaas/vald/tree/main/charts/vald/values">here</a>.
Please refer it for more details.</p>
<h3 id="general">General</h3>
<p>Regardless of the backup destination, the following Vald Agent settings must be set to enable backup.</p>
<ul>
<li><code>agent.ngt.index_path</code> is the location where those files are stored.</li>
<li><code>agent.ngt.in-memory-mode=false</code> means storing index files in the local volume.</li>
</ul>
<p>In addition, <code>agent.terminationGracePeriodSeconds</code> value should be long enough to ensure the backup speed.</p>
<pre><code class="language-yaml"><span class="hljs-attr">agent:</span>
  <span class="hljs-string">...</span>
  <span class="hljs-comment"># We recommend setting this value long enough to ensure the backup speed of PV, since the Index is backed up at the end of the pod.</span>
  <span class="hljs-attr">terminationGracePeriodSeconds:</span> <span class="hljs-number">3600</span>
  <span class="hljs-attr">ngt:</span>
    <span class="hljs-string">...</span>
    <span class="hljs-attr">index_path:</span> <span class="hljs-string">&quot;/var/ngt/index&quot;</span>
    <span class="hljs-attr">enable_in_memory_mode:</span> <span class="hljs-literal">false</span>
    <span class="hljs-string">...</span>
</code></pre>
<h3 id="persistent-volume">Persistent Volume</h3>
<h4 id="requirement">requirement</h4>
<p>You must prepare PV before deployment when using Kubernetes Persistent Volume (PV) for backup storage.
Please refer to the setup guide of the usage environment for the provisioning PV.</p>
<p>For example:</p>
<ul>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/concepts/persistent-volumes">GKE setup PV document</a></li>
<li><a href="https://docs.aws.amazon.com/eks/latest/userguide/storage.html">EKS storage document</a></li>
</ul>
<h4 id="configuration">configuration</h4>
<p>After provisioning PV, the following parameters are needed to be set.
It shows the example for using GKE.</p>
<pre><code class="language-yaml"><span class="hljs-attr">agent:</span>
  <span class="hljs-string">...</span>
  <span class="hljs-attr">persistentVolume:</span>
    <span class="hljs-comment"># use PV flag</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-comment"># accessMode for PV (please verify your environment).</span>
    <span class="hljs-attr">accessMode:</span> <span class="hljs-string">ReadWriteOnce</span>
    <span class="hljs-comment"># storage class for PV (please verify your environment)</span>
    <span class="hljs-attr">storageClass:</span> <span class="hljs-string">standard</span>
    <span class="hljs-comment"># set enough size for backup</span>
    <span class="hljs-attr">size:</span> <span class="hljs-string">2Gi</span>
  <span class="hljs-string">...</span>
  <span class="hljs-attr">terminationGracePeriodSeconds:</span> <span class="hljs-number">3600</span>
  <span class="hljs-string">...</span>
  <span class="hljs-attr">ngt:</span>
    <span class="hljs-string">...</span>
    <span class="hljs-attr">index_path:</span> <span class="hljs-string">&quot;/var/ngt/index&quot;</span>
    <span class="hljs-attr">enable_in_memory_mode:</span> <span class="hljs-literal">false</span>
    <span class="hljs-comment"># copy on write function flag</span>
    <span class="hljs-attr">enable_copy_on_write:</span> <span class="hljs-literal">true</span>
    <span class="hljs-string">...</span>
</code></pre>
<p>Each PV will be mounted on each Vald Agent Pod's <code>index_path</code>.</p>
<p>You can choose <code>copy_on_write</code> (CoW) function.</p>
<p>The CoW is an option to update the backup file safely.</p>
<p>The backup file may be corrupted, and the Vald Agent pod may not restore from backup files when the Vald Agent pod terminates during saveIndex without CoW is not be enabled.
On the other hand, if CoW is enabled, the Vald Agent pod can restore the data from one generation ago.</p>
<div class="caution">
When CoW is enabled, PV temporarily has two backup files; new and old versions.<BR>
So, A double storage capacity is required if CoW is enabled, e.g., when set 2Gi as size without CoW, the size should be more than 4Gi with CoW.
</div>
<h3 id="s3">S3</h3>
<h4 id="requirement-1">requirement</h4>
<p>Before deployment, you must provision the S3 object storage.
You can use any S3-compatible object storage.</p>
<p>For example:</p>
<ul>
<li><a href="https://aws.amazon.com/s3/">AWS S3</a></li>
<li><a href="https://cloud.google.com/storage/docs/">Google Cloud Storage</a></li>
</ul>
<h4 id="configuration-1">configuration</h4>
<p>After provisioning the object storage, the following parameters are needed to be set.
To enable the backup function with S3, the Vald Agent Sidecar should be enabled.</p>
<pre><code class="language-yaml"><span class="hljs-attr">agent:</span>
  <span class="hljs-string">...</span>
  <span class="hljs-attr">terminationGracePeriodSeconds:</span> <span class="hljs-number">3600</span>
  <span class="hljs-string">...</span>
  <span class="hljs-attr">ngt:</span>
    <span class="hljs-string">...</span>
    <span class="hljs-attr">index_path:</span> <span class="hljs-string">&quot;/var/ngt/index&quot;</span>
    <span class="hljs-attr">enable_in_memory_mode:</span> <span class="hljs-literal">false</span>
    <span class="hljs-string">...</span>
  <span class="hljs-attr">sidecar:</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-comment"># run sidecar with initContainerMode or not</span>
    <span class="hljs-attr">initContainerEnabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-comment"># This is the Amazon S3 settings.</span>
    <span class="hljs-comment"># Please change it according to your environment.</span>
    <span class="hljs-attr">config:</span>
      <span class="hljs-attr">blob_storage:</span>
        <span class="hljs-comment"># storage type (default: s3)</span>
        <span class="hljs-attr">storage_type:</span> <span class="hljs-string">&quot;s3&quot;</span>
        <span class="hljs-comment"># your bucket name</span>
        <span class="hljs-attr">bucket:</span> <span class="hljs-string">&quot;vald&quot;</span>
        <span class="hljs-attr">s3:</span>
          <span class="hljs-attr">region:</span> <span class="hljs-string">&quot;us-central1&quot;</span>
    <span class="hljs-comment"># If you enable sidecar, the following environment variables will be created automatically by default values.</span>
    <span class="hljs-comment"># So, please create the &#x27;aws-secret&#x27; resource before deploying.</span>
    <span class="hljs-comment"># env:</span>
    <span class="hljs-comment">#   - name: AWS_ACCESS_KEY</span>
    <span class="hljs-comment">#     valueFrom:</span>
    <span class="hljs-comment">#       secretKeyRef:</span>
    <span class="hljs-comment">#         name: aws-secret</span>
    <span class="hljs-comment">#         key: access-key</span>
    <span class="hljs-comment">#   - name: AWS_SECRET_ACCESS_KEY</span>
    <span class="hljs-comment">#     valueFrom:</span>
    <span class="hljs-comment">#       secretKeyRef:</span>
    <span class="hljs-comment">#         name: aws-secret</span>
    <span class="hljs-comment">#         key: secret-access-key</span>
</code></pre>
<p>The Vald Agent Sidecar needs an access key and a secret access key to communicate with your object storage.
Before applying the helm chart, register each value in Kubernetes secrets with the following commands.</p>
<pre><code class="language-bash">kubectl create secret -n &lt;Vald cluster namespace&gt; aws-secret --access-key=&lt;ACCESS KEY&gt; --secret-access-key=&lt;SECRET ACCESSS KEY&gt;
</code></pre>
<h3 id="persistent-volume-and-s3">Persistent Volume and S3</h3>
<p>You can use both PV and S3 at the same time.
Please refer to the before sections for provisioning storages.</p>
<pre><code class="language-yaml"><span class="hljs-attr">agent:</span>
  <span class="hljs-string">...</span>
  <span class="hljs-attr">terminationGracePeriodSeconds:</span> <span class="hljs-number">3600</span>
  <span class="hljs-string">...</span>
  <span class="hljs-attr">persistentVolume:</span>
    <span class="hljs-comment"># use PV flag</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-comment"># accessMode for PV (please verify your environment)</span>
    <span class="hljs-attr">accessMode:</span> <span class="hljs-string">ReadWriteOnce</span>
    <span class="hljs-comment"># storage class for PV (please verify your environment)</span>
    <span class="hljs-attr">storageClass:</span> <span class="hljs-string">standard</span>
    <span class="hljs-comment"># set enough size for backup</span>
    <span class="hljs-attr">size:</span> <span class="hljs-string">2Gi</span>
  <span class="hljs-attr">ngt:</span>
    <span class="hljs-string">...</span>
    <span class="hljs-attr">enable_in_memory_mode:</span> <span class="hljs-literal">false</span>
    <span class="hljs-comment"># copy on write function flag</span>
    <span class="hljs-attr">enable_copy_on_write:</span> <span class="hljs-literal">true</span>
    <span class="hljs-string">...</span>
  <span class="hljs-attr">sidecar:</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-comment"># run sidecar with initContainerMode or not. If true, it allows restoration.</span>
    <span class="hljs-attr">initContainerEnabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-comment"># This is the Amazon S3 settings.</span>
    <span class="hljs-comment"># Please change it according to your environment.</span>
    <span class="hljs-attr">config:</span>
      <span class="hljs-attr">blob_storage:</span>
        <span class="hljs-comment"># storage type (default: s3)</span>
        <span class="hljs-attr">storage_type:</span> <span class="hljs-string">&quot;s3&quot;</span>
        <span class="hljs-comment"># your bucket name</span>
        <span class="hljs-attr">bucket:</span> <span class="hljs-string">&quot;vald&quot;</span>
        <span class="hljs-attr">s3:</span>
          <span class="hljs-attr">region:</span> <span class="hljs-string">&quot;us-central1&quot;</span>
    <span class="hljs-comment"># If you enable sidecar, the following environment variables will be created automatically by default values.</span>
    <span class="hljs-comment"># So, please create the &#x27;aws-secret&#x27; resource before deploying.</span>
    <span class="hljs-comment"># env:</span>
    <span class="hljs-comment">#   - name: AWS_ACCESS_KEY</span>
    <span class="hljs-comment">#     valueFrom:</span>
    <span class="hljs-comment">#       secretKeyRef:</span>
    <span class="hljs-comment">#         name: aws-secret</span>
    <span class="hljs-comment">#         key: access-key</span>
    <span class="hljs-comment">#   - name: AWS_SECRET_ACCESS_KEY</span>
    <span class="hljs-comment">#     valueFrom:</span>
    <span class="hljs-comment">#       secretKeyRef:</span>
    <span class="hljs-comment">#         name: aws-secret</span>
    <span class="hljs-comment">#         key: secret-access-key</span>
    <span class="hljs-string">...</span>
</code></pre>
<h2 id="restore">Restore</h2>
<p>Restoring from the backup file runs on start Pod when the config is set correctly, and the backup file exists.</p>
<h3 id="pv">PV</h3>
<p>In using the PV case, restoration starts when Pod starts.</p>
<p>If the configuration is correct, the backup file will be automatically mounted, loaded, and indexed when the Pod starts.</p>
<h3 id="s3-1">S3</h3>
<p>In using the S3 case, restoration runs only <code>initContainerMode</code>.
To enable restoration, you have to set <code>sidecar.initContainerMode</code> as <code>true</code>.</p>
<p>Agent Sidecar tries to get the backup file from S3, unpacks it, and starts indexing.</p>
<h3 id="pv--s3">PV + S3</h3>
<p>In using both the PV and S3 case, the backup file used for restoration will prioritize the file on PV.
If the backup file does not exist on the PV, the backup file will be retrieved from S3 via the Vald Agent Sidecar and restored.</p>
<h2 id="broken-index-backup">Broken index backup</h2>
<p>If a backup file of an index is corrupted for some reason, Vald agent fails to load the index file, and the index file is then identified as a broken index.</p>
<blockquote>
<p>Causes of broken index could be agent crash during save index operation, partial storage corruption, etc.</p>
</blockquote>
<p>When an index is broken, the default behavior is to discard it and continue running the Pod. This is useful for saving storage space, but sometimes you may need to inspect the contents of a broken index at a later time. By enabling the <code>broken index backup</code> feature, a backup is created without deleting the broken index before running the Pod. This feature can help you investigate the cause of index corruption at a later time.</p>
<h3 id="settings">Settings</h3>
<p>To enable this feature, set the <code>agent.ngt.broken_index_history_limit</code> setting to at least 1 (default: 0). The system stores backups of broken indexes up to the number of generations specified by this variable. If a backup of a broken index is needed that goes beyond this value, the system will delete the oldest backup.</p>
<pre><code>agent:
  ngt:
    ...
    broken_index_history_limit: 3
    ...
</code></pre>
<h3 id="backup-location">Backup location</h3>
<p>The backup is stored under <code>${index_path}/broken</code>. Each directory name represents the Unix nanosecond when an attempt was made to read the broken index.</p>
<pre><code>${index_path}/
  origin/
    ngt-meta.kvsdb
    ngt-timestamp.kvsdb
    metadata.json
    prf
    grp
    tre
    obj
  broken/
    1611271735938403848/
      ngt-meta.kvsdb
      ...
    1611271749583028942/
      ngt-meta.kvsdb
      ...
    1611271759849304593/
      ngt-meta.kvsdb
      ...
</code></pre>
<h3 id="restore-1">Restore</h3>
<h4 id="cow-disabled">CoW: disabled</h4>
<p>If an index file exists under <code>${index_path}/origin</code>, restore is attempted based on that index file. If the restore fails, the index file is backed up as a broken index. The agent starts in its initial state.</p>
<h4 id="cow-enabled">CoW: enabled</h4>
<p>If an index file exists under <code>${index_path}/origin</code>, restore is attempted based on that index file. If the restore fails, <code>${index_path}/origin</code> is backed up as a broken index at that point. Then, restore is attempted based on the index file in <code>${index_path}/backup</code> (one generation older index file). If the restore fails again, the agent starts in its initial state.</p>
<h3 id="metrics">Metrics</h3>
<p>The number of generations of broken indexes currently stored can be obtained as a metric <code>agent_core_ngt_broken_index_store_count</code>.</p>
<p>Reference: <a href="https://github.com/vdaas/vald/blob/main/k8s/metrics/grafana/dashboards/01-vald-agent.yaml">vald/k8s/metrics/grafana/dashboards/01-vald-agent.yaml</a></p>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            <script async type="text/javascript">
/* From extension marp-team.marp-vscode */
(()=>{var W=Object.defineProperty;var K=(w,h,x)=>h in w?W(w,h,{enumerable:!0,configurable:!0,writable:!0,value:x}):w[h]=x;var o=(w,h)=>W(w,"name",{value:h,configurable:!0});var v=(w,h,x)=>K(w,typeof h!="symbol"?h+"":h,x);(()=>{var w={32:(y,S,g)=>{y.exports=g(924)},924:(y,S)=>{"use strict";var g;g={value:!0};const E={h1:{proto:o(()=>HTMLHeadingElement,"proto"),attrs:{role:"heading","aria-level":"1"},style:"display: block; font-size: 2em; margin-block-start: 0.67em; margin-block-end: 0.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h2:{proto:o(()=>HTMLHeadingElement,"proto"),attrs:{role:"heading","aria-level":"2"},style:"display: block; font-size: 1.5em; margin-block-start: 0.83em; margin-block-end: 0.83em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h3:{proto:o(()=>HTMLHeadingElement,"proto"),attrs:{role:"heading","aria-level":"3"},style:"display: block; font-size: 1.17em; margin-block-start: 1em; margin-block-end: 1em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h4:{proto:o(()=>HTMLHeadingElement,"proto"),attrs:{role:"heading","aria-level":"4"},style:"display: block; margin-block-start: 1.33em; margin-block-end: 1.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h5:{proto:o(()=>HTMLHeadingElement,"proto"),attrs:{role:"heading","aria-level":"5"},style:"display: block; font-size: 0.83em; margin-block-start: 1.67em; margin-block-end: 1.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h6:{proto:o(()=>HTMLHeadingElement,"proto"),attrs:{role:"heading","aria-level":"6"},style:"display: block; font-size: 0.67em; margin-block-start: 2.33em; margin-block-end: 2.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},span:{proto:o(()=>HTMLSpanElement,"proto")},pre:{proto:o(()=>HTMLElement,"proto"),style:"display: block; font-family: monospace; white-space: pre; margin: 1em 0; --marp-auto-scaling-white-space: pre;"}},A="data-marp-auto-scaling-wrapper",p="data-marp-auto-scaling-svg",c="data-marp-auto-scaling-container",T=class T extends HTMLElement{constructor(){super();v(this,"container");v(this,"containerSize");v(this,"containerObserver");v(this,"svg");v(this,"svgComputedStyle");v(this,"svgPreserveAspectRatio","xMinYMid meet");v(this,"wrapper");v(this,"wrapperSize");v(this,"wrapperObserver");const s=o(t=>([e])=>{const{width:n,height:r}=e.contentRect;this[t]={width:n,height:r},this.updateSVGRect()},"e");this.attachShadow({mode:"open"}),this.containerObserver=new ResizeObserver(s("containerSize")),this.wrapperObserver=new ResizeObserver((...t)=>{s("wrapperSize")(...t),this.flushSvgDisplay()})}static get observedAttributes(){return["data-downscale-only"]}connectedCallback(){this.shadowRoot.innerHTML=`
<style>
  svg[${p}] { display: block; width: 100%; height: auto; vertical-align: top; }
  span[${c}] { display: table; white-space: var(--marp-auto-scaling-white-space, nowrap); width: max-content; }
</style>
<div ${A}>
  <svg part="svg" ${p}>
    <foreignObject><span ${c}><slot></slot></span></foreignObject>
  </svg>
</div>
    `.split(/\n\s*/).join(""),this.wrapper=this.shadowRoot.querySelector(`div[${A}]`)??void 0;const s=this.svg;this.svg=this.wrapper?.querySelector(`svg[${p}]`)??void 0,this.svg!==s&&(this.svgComputedStyle=this.svg?window.getComputedStyle(this.svg):void 0),this.container=this.svg?.querySelector(`span[${c}]`)??void 0,this.observe()}disconnectedCallback(){this.svg=void 0,this.svgComputedStyle=void 0,this.wrapper=void 0,this.container=void 0,this.observe()}attributeChangedCallback(){this.observe()}flushSvgDisplay(){const{svg:s}=this;s&&(s.style.display="inline",requestAnimationFrame(()=>{s.style.display=""}))}observe(){this.containerObserver.disconnect(),this.wrapperObserver.disconnect(),this.wrapper&&this.wrapperObserver.observe(this.wrapper),this.container&&this.containerObserver.observe(this.container),this.svgComputedStyle&&this.observeSVGStyle(this.svgComputedStyle)}observeSVGStyle(s){const t=o(()=>{const e=(()=>{const n=s.getPropertyValue("--preserve-aspect-ratio");return n?n.trim():`x${(({textAlign:r,direction:l})=>{if(r.endsWith("left"))return"Min";if(r.endsWith("right"))return"Max";if(r==="start"||r==="end"){let d=l==="rtl";return r==="end"&&(d=!d),d?"Max":"Min"}return"Mid"})(s)}YMid meet`})();e!==this.svgPreserveAspectRatio&&(this.svgPreserveAspectRatio=e,this.updateSVGRect()),s===this.svgComputedStyle&&requestAnimationFrame(t)},"t");t()}updateSVGRect(){let s=Math.ceil(this.containerSize?.width??0);const t=Math.ceil(this.containerSize?.height??0);this.dataset.downscaleOnly!==void 0&&(s=Math.max(s,this.wrapperSize?.width??0));const e=this.svg?.querySelector(":scope > foreignObject");if(e?.setAttribute("width",`${s}`),e?.setAttribute("height",`${t}`),this.svg&&(this.svg.setAttribute("viewBox",`0 0 ${s} ${t}`),this.svg.setAttribute("preserveAspectRatio",this.svgPreserveAspectRatio),this.svg.style.height=s<=0||t<=0?"0":""),this.container){const n=this.svgPreserveAspectRatio.toLowerCase();this.container.style.marginLeft=n.startsWith("xmid")||n.startsWith("xmax")?"auto":"0",this.container.style.marginRight=n.startsWith("xmi")?"auto":"0"}}};o(T,"s");let i=T;const m=o((a,{attrs:u={},style:s})=>class extends a{constructor(...t){super(...t);for(const[e,n]of Object.entries(u))this.hasAttribute(e)||this.setAttribute(e,n);this._shadow()}static get observedAttributes(){return["data-auto-scaling"]}connectedCallback(){this._update()}attributeChangedCallback(){this._update()}_shadow(){if(!this.shadowRoot)try{this.attachShadow({mode:"open"})}catch(t){if(!(t instanceof Error&&t.name==="NotSupportedError"))throw t}return this.shadowRoot}_update(){const t=this._shadow();if(t){const e=s?`<style>:host { ${s} }</style>`:"";let n="<slot></slot>";const{autoScaling:r}=this.dataset;r!==void 0&&(n=`<marp-auto-scaling exportparts="svg:auto-scaling" ${r==="downscale-only"?"data-downscale-only":""}>${n}</marp-auto-scaling>`),t.innerHTML=e+n}}},"r");let b;const z=Symbol();let $;const V="marpitSVGPolyfill:setZoomFactor,",C=Symbol(),j=Symbol(),G=o(()=>{const a=navigator.vendor==="Apple Computer, Inc.",u=a?[D]:[],s={then:o(t=>(a?(async()=>{if($===void 0){const e=document.createElement("canvas");e.width=10,e.height=10;const n=e.getContext("2d"),r=new Image(10,10),l=new Promise(d=>{r.addEventListener("load",()=>d())});r.crossOrigin="anonymous",r.src="data:image/svg+xml;charset=utf8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2210%22%20height%3D%2210%22%20viewBox%3D%220%200%201%201%22%3E%3CforeignObject%20width%3D%221%22%20height%3D%221%22%20requiredExtensions%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22width%3A%201px%3B%20height%3A%201px%3B%20background%3A%20red%3B%20position%3A%20relative%22%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3C%2Fsvg%3E",await l,n.drawImage(r,0,0),$=n.getImageData(5,5,1,1).data[3]<128}return $})().then(e=>{t?.(e?[D]:[])}):t?.([]),s),"then")};return Object.assign(u,s)},"g");let H,O;function D(a){const u=typeof a=="object"&&a.target||document,s=typeof a=="object"?a.zoom:a;window[j]||(Object.defineProperty(window,j,{configurable:!0,value:!0}),document.body.style.zoom=1.0001,document.body.offsetHeight,document.body.style.zoom=1,window.addEventListener("message",({data:e,origin:n})=>{if(n===window.origin)try{if(e&&typeof e=="string"&&e.startsWith(V)){const[,r]=e.split(","),l=Number.parseFloat(r);Number.isNaN(l)||(O=l)}}catch(r){console.error(r)}}));let t=!1;Array.from(u.querySelectorAll("svg[data-marpit-svg]"),e=>{var n,r,l,d;e.style.transform||(e.style.transform="translateZ(0)");const f=s||O||e.currentScale||1;H!==f&&(H=f,t=f);const P=e.getBoundingClientRect(),{length:Z}=e.children;for(let F=0;F<Z;F+=1){const k=e.children[F];if(k.getScreenCTM){const _=k.getScreenCTM();if(_){const Y=(r=(n=k.x)===null||n===void 0?void 0:n.baseVal.value)!==null&&r!==void 0?r:0,U=(d=(l=k.y)===null||l===void 0?void 0:l.baseVal.value)!==null&&d!==void 0?d:0,J=k.children.length;for(let R=0;R<J;R+=1){const N=k.children[R];if(N.tagName==="SECTION"){const{style:q}=N;q.transformOrigin||(q.transformOrigin=`${-Y}px ${-U}px`),q.transform=`scale(${f}) matrix(${_.a}, ${_.b}, ${_.c}, ${_.d}, ${_.e-P.left}, ${_.f-P.top}) translateZ(0.0001px)`;break}}}}}}),t!==!1&&Array.from(u.querySelectorAll("iframe"),({contentWindow:e})=>{e?.postMessage(`${V}${t}`,window.origin==="null"?"*":window.origin)})}o(D,"u");function B({once:a=!1,target:u=document}={}){const s=function(t=document){if(t[C])return t[C];let e=!0;const n=o(()=>{e=!1,delete t[C]},"i");Object.defineProperty(t,C,{configurable:!0,value:n});let r=[],l=!1;(async()=>{try{r=await G()}finally{l=!0}})();const d=o(()=>{for(const f of r)f({target:t});l&&r.length===0||e&&window.requestAnimationFrame(d)},"r");return d(),n}(u);return a?(s(),()=>{}):s}o(B,"v"),H=1,O=void 0;const I=B,M=Symbol(),L=o((a=document)=>{if(typeof window>"u")throw new Error("Marp Core's browser script is valid only in browser context.");if(((e=document)=>{const n=window[z];n||customElements.define("marp-auto-scaling",i);for(const r of Object.keys(E)){const l=`marp-${r}`,d=E[r].proto();(b??(b=!!document.createElement("div",{is:"marp-auto-scaling"}).outerHTML.startsWith("<div is"),b))&&d!==HTMLElement?n||customElements.define(l,m(d,{style:E[r].style}),{extends:r}):(n||customElements.define(l,m(HTMLElement,E[r])),e.querySelectorAll(`${r}[is="${l}"]`).forEach(f=>{f.outerHTML=f.outerHTML.replace(new RegExp(`^<${r}`,"i"),`<${l}`).replace(new RegExp(`</${r}>$`,"i"),`</${l}>`)}))}window[z]=!0})(a),a[M])return a[M];const u=B({target:a}),s=o(()=>{u(),delete a[M]},"n"),t=Object.assign(s,{cleanup:s,update:o(()=>L(a),"update")});return Object.defineProperty(a,M,{configurable:!0,value:t}),t},"y");S.browser=L,g=L,g=I}},h={};function x(y){var S=h[y];if(S!==void 0)return S.exports;var g=h[y]={exports:{}};return w[y](g,g.exports,x),g.exports}o(x,"__webpack_require__");var Q={};(()=>{"use strict";var y=x(32);function S(){let p,c;const i=o(()=>{const m=document.getElementById("__marp-vscode"),b=!!m;p!==b?(document.body.classList.toggle("marp-vscode",b),b?c=(0,y.browser)():(c?.cleanup(),c=void 0),p=b):b&&c?.update(),p?(m&&g(m),E()):A()},"updateCallback");window.addEventListener("load",()=>window.setTimeout(i,100)),window.addEventListener("vscode.markdown.updateContent",i),i()}o(S,"preview");const g=o(p=>{p.querySelectorAll("[is]").forEach(c=>{if(c.nodeName.includes("-")||document.createElement(c.nodeName).constructor!==c.constructor)return;const{outerHTML:m}=c;c.outerHTML=m,console.debug("[marp-vscode] Custom element has been upgraded forcibly:",m.slice(0,m.indexOf(">")+1||void 0))})},"forceUpgradeCustomElements"),E=o(()=>{const p=document.querySelectorAll("style:not(#__marp-vscode-style,#_defaultStyles,[data-marp-vscode-body])"),c=document.querySelectorAll('link[rel="stylesheet"][href]:not([href*="marp-vscode"])');p.forEach(i=>{i.closest("#__marp-vscode")||(i.dataset.marpVscodeBody=i.textContent??"",i.textContent="")}),c.forEach(i=>{if(i.closest("#__marp-vscode"))return;const{href:m}=i;i.dataset.marpVscodeHref=m,i.removeAttribute("href")})},"removeStyles"),A=o(()=>{const p=document.querySelectorAll("style[data-marp-vscode-body]"),c=document.querySelectorAll("link[data-marp-vscode-href]");p.forEach(i=>{i.textContent=i.dataset.marpVscodeBody||"",delete i.dataset.marpVscodeBody}),c.forEach(i=>{i.href=i.dataset.marpVscodeHref||"",delete i.dataset.marpVscodeHref})},"restoreStyles");S()})()})();})();

</script>

        </body>
        </html>