<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>Multiple Vald Clusters using Vald Mirror Gateway</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

/* From extension marp-team.marp-vscode */
#__marp-vscode {
  all: revert;
}

/* Override VS Code default CSS rules reverting to initial
   https://github.com/microsoft/vscode/blob/master/src/vs/workbench/contrib/webview/browser/pre/main.js#L53 */
body.marp-vscode {
  padding: 0;
}

body.marp-vscode img {
  max-width: unset;
  max-height: unset;
}

body.marp-vscode a,
body.marp-vscode a:hover,
body.marp-vscode code {
  color: unset;
}

body.marp-vscode blockquote {
  background: unset;
  border-color: unset;
}

@media screen {
  body.marp-vscode {
    overflow-y: scroll;

    /* stylelint-disable-next-line selector-class-pattern */
    &.showEditorSelection {
      --marp-vscode-highlight-color: rgb(255 255 255 / 40%);

      &.vscode-light {
        --marp-vscode-highlight-color: rgb(0 0 0 / 15%);
      }

      &.vscode-high-contrast {
        --marp-vscode-highlight-color: rgb(255 160 0 / 70%);
      }
    }
  }

  #__marp-vscode [data-marp-vscode-slide-wrapper] {
    margin: 20px;
    position: relative;

    &.code-active-line,
    &:has(.code-active-line) {
      &::before {
        position: absolute;
        content: '';
        inset: -7px;
        border: 3px solid var(--marp-vscode-highlight-color, transparent);
        pointer-events: none;
      }
    }
  }

  #__marp-vscode svg[data-marpit-svg] {
    box-shadow: 0 5px 10px rgb(0 0 0 / 25%);
    display: block;
    margin: 0;
  }

  /* Based on https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
  #code-csp-warning {
    background-color: #444;
    box-shadow: 1px 1px 1px rgb(0 0 0 / 25%);
    color: white;
    cursor: pointer;
    font-family: sans-serif;
    font-size: 12px;
    line-height: 22px;
    margin: 16px;
    padding: 6px;
    position: fixed;
    right: 0;
    text-align: center;
    top: 0;
    word-wrap: break-word;
  }

  #code-csp-warning:hover {
    text-decoration: none;
    background-color: #007acc;
    box-shadow: 2px 2px 2px rgb(0 0 0 / 25%);
  }
}

@media print {
  body.marp-vscode #code-csp-warning {
    display: none;
  }
}

</style>
            
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="multiple-vald-clusters-using-vald-mirror-gateway">Multiple Vald Clusters using Vald Mirror Gateway</h1>
<p>This article shows how to deploy multiple Vald clusters on your Kubernetes cluster.</p>
<h2 id="overview">Overview</h2>
<p>Vald cluster consists of multiple microservices.</p>
<p>In <a href="https://vald.vdaas.org/docs/tutorial/get-started">Get Started</a>, you may use 4 kinds of components to deploy the Vald cluster.</p>
<p>In this tutorial, you will deploy multiple Vald clusters with Vald Mirror Gateway, which connects another Vald cluster.</p>
<p>The below image shows the architecture image of this case.</p>
<img src="file:////go/src/github.com/vdaas/vald/assets/docs/tutorial/vald-multicluster-on-k8s.png">
<h2 id="requirements">Requirements</h2>
<ul>
<li>Vald: v1.8 ~</li>
<li>Kubernetes: v1.27 ~</li>
<li>Go: v1.20 ~</li>
<li>Helm: v3 ~</li>
<li>libhdf5 (<em>only required to get started</em>)</li>
</ul>
<p>Helm is used to deploy Vald cluster on your Kubernetes and HDF5 is used to decode the sample data file to run the example code.</p>
<p>If Helm or HDF5 is not installed, please install <a href="https://helm.sh/docs/intro/install">Helm</a> and <a href="https://www.hdfgroup.org/">HDF5</a>.</p>
<details><summary>Installation command for Helm</summary><br>
<pre><code class="language-bash">curl -fsSL https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
</code></pre>
</details>
<details><summary>Installation command for HDF5</summary><br>
<pre><code class="language-bash"><span class="hljs-comment"># yum</span>
yum install -y hdf5-devel

<span class="hljs-comment"># apt</span>
apt-get install libhdf5-serial-dev

<span class="hljs-comment"># homebrew</span>
brew install hdf5
</code></pre>
</details>
<h2 id="prepare-the-kubernetes-cluster">Prepare the Kubernetes Cluster</h2>
<p>This tutorial requires the Kubernetes cluster.</p>
<p>Vald cluster runs on public Cloud Kubernetes Services such as GKE, EKS.
In the sense of trying to <code>Get Started</code>, <a href="https://k3d.io/">k3d</a> or <a href="https://kind.sigs.k8s.io/">kind</a> are easy Kubernetes tools to use.</p>
<p>This tutorial uses <a href="https://github.com/kubernetes-sigs/metrics-server">Kubernetes Metrics Server</a> for running the Vald cluster.</p>
<p>Please make sure these functions are available.</p>
<p>The way to deploy Kubernetes Metrics Service is here:</p>
<pre><code class="language-bash">kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml &amp;&amp; \
kubectl <span class="hljs-built_in">wait</span> -n kube-system --<span class="hljs-keyword">for</span>=condition=ready pod -l k8s-app=metrics-server --<span class="hljs-built_in">timeout</span>=600s
</code></pre>
<p>Please prepare three Namespaces on the Kubernetes cluster.</p>
<pre><code class="language-bash">kubectl create namespace vald-01 &amp;&amp; \
kubectl create namespace vald-02 &amp;&amp; \
kubectl create namespace vald-03
</code></pre>
<h2 id="deploy-vald-clusters-on-each-kubernetes-namespace">Deploy Vald Clusters on each Kubernetes Namespace</h2>
<p>This chapter shows how to deploy the multiple Vald clusters using Helm and run it on your Kubernetes cluster.
In this section, you will deploy three Vald clusters consisting of <code>vald-agent-ngt</code>, <code>vald-lb-gateway</code>, <code>vald-discoverer</code>, <code>vald-manager-index</code>, and <code>vald-mirror-gateway</code> using the basic configuration.</p>
<ol>
<li>
<p>Clone the repository</p>
<p>To use the <code>deployment</code> YAML for deployment, let’s clone <code>[vdaas/vald](https://github.com/vdaas/vald.git)</code> repository.</p>
<pre><code class="language-bash">git <span class="hljs-built_in">clone</span> https://github.com/vdaas/vald.git &amp;&amp;　<span class="hljs-built_in">cd</span> vald
</code></pre>
</li>
<li>
<p>Deploy on the <code>vald-01</code> Namespace using <a href="https://github.com/vdaas/vald/blob/main/charts/vald/values/multi-vald/dev-vald-01.yaml">dev-vald-01.yaml</a> and <a href="https://github.com/vdaas/vald/blob/main/example/helm/values.yaml">values.yaml</a></p>
<pre><code class="language-bash">helm install vald-cluster-01 charts/vald \
  -f ./example/helm/values.yaml \
  -f ./charts/vald/values/multi-vald/dev-vald-01.yaml \
  -n vald-01
</code></pre>
</li>
<li>
<p>Deploy on the <code>vald-02</code> Namespace using <a href="https://github.com/vdaas/vald/blob/main/charts/vald/values/multi-vald/dev-vald-02.yaml">dev-vald-02.yaml</a> and <a href="https://github.com/vdaas/vald/blob/main/example/helm/values.yaml">values.yaml</a></p>
<pre><code class="language-bash">helm install vald-cluster-02 charts/vald \
  -f ./example/helm/values.yaml \
  -f ./charts/vald/values/multi-vald/dev-vald-02.yaml \
  -n vald-02
</code></pre>
</li>
<li>
<p>Deploy on the <code>vald-03</code> Namespace using <a href="https://github.com/vdaas/vald/blob/main/charts/vald/values/multi-vald/dev-vald-03.yaml">dev-vald-03.yaml</a> and <a href="https://github.com/vdaas/vald/blob/main/example/helm/values.yaml">values.yaml</a></p>
<pre><code class="language-bash">helm install vald-cluster-03 charts/vald \
  -f ./example/helm/values.yaml \
  -f ./charts/vald/values/multi-vald/dev-vald-03.yaml \
  -n vald-03
</code></pre>
</li>
<li>
<p>Verify</p>
<p>If success deployment, the Vald cluster’s components should run on each Kubernetes Namespace.</p>
 <details><summary>vald-01 Namespace</summary><br>
<pre><code class="language-bash">kubectl get pods -n vald-01
NAME                                   READY   STATUS    RESTARTS   AGE
vald-agent-ngt-0                       1/1     Running   0          2m41s
vald-agent-ngt-2                       1/1     Running   0          2m41s
vald-agent-ngt-3                       1/1     Running   0          2m41s
vald-agent-ngt-4                       1/1     Running   0          2m41s
vald-agent-ngt-5                       1/1     Running   0          2m41s
vald-agent-ngt-1                       1/1     Running   0          2m41s
vald-discoverer-77967c9697-brbsp       1/1     Running   0          2m41s
vald-lb-gateway-587879d598-xmws7       1/1     Running   0          2m41s
vald-lb-gateway-587879d598-dzn9c       1/1     Running   0          2m41s
vald-manager-index-56d474c848-wkh6b    1/1     Running   0          2m41s
vald-lb-gateway-587879d598-9wb5q       1/1     Running   0          2m41s
vald-mirror-gateway-6df75cf7cf-gzcr4   1/1     Running   0          2m26s
vald-mirror-gateway-6df75cf7cf-vjbqx   1/1     Running   0          2m26s
vald-mirror-gateway-6df75cf7cf-c2g7t   1/1     Running   0          2m41s
</code></pre>
 </details>
 <details><summary>vald-02 Namespace</summary><br>
<pre><code class="language-bash">kubectl get pods -n vald-02
NAME                                  READY   STATUS    RESTARTS   AGE
vald-agent-ngt-0                      1/1     Running   0          2m52s
vald-agent-ngt-1                      1/1     Running   0          2m52s
vald-agent-ngt-2                      1/1     Running   0          2m52s
vald-agent-ngt-4                      1/1     Running   0          2m52s
vald-agent-ngt-5                      1/1     Running   0          2m52s
vald-agent-ngt-3                      1/1     Running   0          2m52s
vald-discoverer-8cfcff76-vlmpg        1/1     Running   0          2m52s
vald-lb-gateway-54896f9f49-wtlcv      1/1     Running   0          2m52s
vald-lb-gateway-54896f9f49-hbklj      1/1     Running   0          2m52s
vald-manager-index-676855f8d7-bb4wb   1/1     Running   0          2m52s
vald-lb-gateway-54896f9f49-kgrdf      1/1     Running   0          2m52s
vald-mirror-gateway-6598cf957-t2nz4   1/1     Running   0          2m37s
vald-mirror-gateway-6598cf957-wr448   1/1     Running   0          2m52s
vald-mirror-gateway-6598cf957-jdd6q   1/1     Running   0          2m37s
</code></pre>
 </details>
 <details><summary>vald-03 Namespace</summary><br>
<pre><code class="language-bash">kubectl get pods -n vald-03
NAME                                   READY   STATUS    RESTARTS   AGE
vald-agent-ngt-0                       1/1     Running   0          2m46s
vald-agent-ngt-1                       1/1     Running   0          2m46s
vald-agent-ngt-2                       1/1     Running   0          2m46s
vald-agent-ngt-3                       1/1     Running   0          2m46s
vald-agent-ngt-4                       1/1     Running   0          2m46s
vald-agent-ngt-5                       1/1     Running   0          2m46s
vald-discoverer-879867b44-8m59h        1/1     Running   0          2m46s
vald-lb-gateway-6c8c6b468d-ghlpx       1/1     Running   0          2m46s
vald-lb-gateway-6c8c6b468d-rt688       1/1     Running   0          2m46s
vald-lb-gateway-6c8c6b468d-jq7pl       1/1     Running   0          2m46s
vald-manager-index-5596f89644-xfv4t    1/1     Running   0          2m46s
vald-mirror-gateway-7b95956f8b-l57jz   1/1     Running   0          2m31s
vald-mirror-gateway-7b95956f8b-xd9n5   1/1     Running   0          2m46s
vald-mirror-gateway-7b95956f8b-dnxbb   1/1     Running   0          2m31s
</code></pre>
 </details>
</li>
</ol>
<h2 id="deploy-valdmirrortarget-resource-custom-resource">Deploy ValdMirrorTarget Resource (Custom Resource)</h2>
<p>It requires applying the <code>ValdMirrorTarget</code> Custom Resource to the one Namespace.</p>
<p>When applied successfully, the destination information is automatically created on other Namespaces when interconnected with each <code>vald-mirror-gateway</code>.</p>
<p>This tutorial will deploy the <a href="https://github.com/vdaas/vald/blob/main/charts/vald/values/multi-vald/mirror-target.yaml">ValdMirrorTarget</a> Custom Resource to the <code>vald-03</code> Namespace with the following command.</p>
<pre><code class="language-bash">kubectl apply -f ./charts/vald/values/multi-vald/mirror-target.yaml -n vald-03
</code></pre>
<p>The current connection status can be checked with the following command.</p>
<details><summary>Example output</summary><br>
<pre><code class="language-bash">kubectl get vmt -A -o wide
NAMESPACE   NAME                                 HOST                                            PORT   STATUS      LAST TRANSITION TIME   AGE
vald-03     mirror-target-01                     vald-mirror-gateway.vald-01.svc.cluster.local   8081   Connected   2023-05-22T02:07:51Z   19m
vald-03     mirror-target-02                     vald-mirror-gateway.vald-02.svc.cluster.local   8081   Connected   2023-05-22T02:07:51Z   19m
vald-02     mirror-target-3296010438411762394    vald-mirror-gateway.vald-01.svc.cluster.local   8081   Connected   2023-05-22T02:07:53Z   19m
vald-02     mirror-target-12697587923462644654   vald-mirror-gateway.vald-03.svc.cluster.local   8081   Connected   2023-05-22T02:07:53Z   19m
vald-01     mirror-target-13698925675968803691   vald-mirror-gateway.vald-02.svc.cluster.local   8081   Connected   2023-05-22T02:07:53Z   19m
vald-01     mirror-target-17825710563723389324   vald-mirror-gateway.vald-03.svc.cluster.local   8081   Connected   2023-05-22T02:07:53Z   19m
</code></pre>
</details>
<h2 id="run-example-code">Run Example Code</h2>
<p>In this chapter, you will execute insert, search, get, and delete vectors to your Vald clusters using the example code.</p>
<p>The <a href="https://github.com/zalandoresearch/fashion-mnist">Fashion-MNIST</a> is used as a dataset for indexing and search query.</p>
<p>The example code is implemented in Go and uses <a href="https://github.com/vdaas/vald-client-go">vald-client-go</a>, one of the official Vald client libraries, for requesting to Vald cluster.</p>
<p>Vald provides multiple language client libraries such as Go, Java, Node.js, Python, etc.</p>
<p>If you are interested, please refer to <a href="https://vald.vdaas.org/docs/user-guides/sdks">SDKs</a>.</p>
<ol>
<li>
<p>Port Forward(option)</p>
<p>If you do NOT use Kubernetes Ingress, port forwarding is required to make requests from your local environment.</p>
<pre><code class="language-bash">kubectl port-forward svc/vald-mirror-gateway 8080:8081 -n vald-01 &amp; \
  kubectl port-forward svc/vald-mirror-gateway 8081:8081 -n vald-02 &amp; \
  kubectl port-forward svc/vald-mirror-gateway 8082:8081 -n vald-03
</code></pre>
</li>
<li>
<p>Download dataset</p>
<p>Move to the working directory.</p>
<pre><code class="language-bash"><span class="hljs-built_in">cd</span> example/client/mirror
</code></pre>
<p>Download <a href="https://github.com/zalandoresearch/fashion-mnist">Fashion-MNIST</a>, which is used as a dataset for indexing and search query.</p>
<pre><code class="language-bash">wget https://ann-benchmarks.com/fashion-mnist-784-euclidean.hdf5
</code></pre>
</li>
<li>
<p>Run Example</p>
<p>We use <a href="https://github.com/vdaas/vald/blob/main/example/client/mirror/main.go">example/client/mirror/main.go</a> to run the example.</p>
<p>This example will insert and index 400 vectors into the Vald cluster from the Fashion-MNIST dataset via <a href="https://grpc.io/">gRPC</a>.
And then, after waiting for indexing, it will request to search the nearest vector 10 times to all Vald clusters. You will get the 10 nearest neighbor vectors for each search query.
And it will request to get vectors using inserted vector ID.</p>
<p>Run example codes by executing the below command.</p>
<pre><code class="language-bash">go run main.go
</code></pre>
<p>See <a href="https://vald.vdaas.org/docs/tutorial/get-started/">GetStarted</a> for an explanation of the example code.</p>
</li>
</ol>
<h2 id="cleanup">Cleanup</h2>
<p>Last, you can remove the deployed Vald cluster by executing the below command.</p>
<pre><code class="language-bash">helm uninstall vald-cluster-01 -n vald-01 &amp;&amp; \
helm uninstall vald-cluster-02 -n vald-02 &amp;&amp; \
helm uninstall vald-cluster-03 -n vald-03
</code></pre>
<p>You can remove all <code>ValdMirrorTarget</code> resources (Custom Resource) with the below command.</p>
<pre><code class="language-bash">kubectl delete --all ValdMirrorTargets -A
</code></pre>
<p>You can remove all created Namespaces with the below command.</p>
<pre><code class="language-bash">kubectl delete namespaces vald-01 vald-02 vald-03
</code></pre>
<h2 id="next-steps">Next Steps</h2>
<p>Congratulation!
You completely entered the World of multiple Vald clusters!</p>
<p>For more information, we recommend you check the following:</p>
<ul>
<li><a href="https://vald.vdaas.org/docs/user-guides/configuration/">Configuration</a></li>
<li><a href="https://vald.vdaas.org/docs/user-guides/mirroring-configuration/">Mirror Configuration</a></li>
<li><a href="https://vald.vdaas.org/docs/user-guides/network-policy/">Network Policy</a></li>
</ul>

            
            <script async type="text/javascript">
/* From extension marp-team.marp-vscode */
(()=>{var W=Object.defineProperty;var K=(w,h,x)=>h in w?W(w,h,{enumerable:!0,configurable:!0,writable:!0,value:x}):w[h]=x;var o=(w,h)=>W(w,"name",{value:h,configurable:!0});var v=(w,h,x)=>K(w,typeof h!="symbol"?h+"":h,x);(()=>{var w={32:(y,S,g)=>{y.exports=g(924)},924:(y,S)=>{"use strict";var g;g={value:!0};const E={h1:{proto:o(()=>HTMLHeadingElement,"proto"),attrs:{role:"heading","aria-level":"1"},style:"display: block; font-size: 2em; margin-block-start: 0.67em; margin-block-end: 0.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h2:{proto:o(()=>HTMLHeadingElement,"proto"),attrs:{role:"heading","aria-level":"2"},style:"display: block; font-size: 1.5em; margin-block-start: 0.83em; margin-block-end: 0.83em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h3:{proto:o(()=>HTMLHeadingElement,"proto"),attrs:{role:"heading","aria-level":"3"},style:"display: block; font-size: 1.17em; margin-block-start: 1em; margin-block-end: 1em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h4:{proto:o(()=>HTMLHeadingElement,"proto"),attrs:{role:"heading","aria-level":"4"},style:"display: block; margin-block-start: 1.33em; margin-block-end: 1.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h5:{proto:o(()=>HTMLHeadingElement,"proto"),attrs:{role:"heading","aria-level":"5"},style:"display: block; font-size: 0.83em; margin-block-start: 1.67em; margin-block-end: 1.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h6:{proto:o(()=>HTMLHeadingElement,"proto"),attrs:{role:"heading","aria-level":"6"},style:"display: block; font-size: 0.67em; margin-block-start: 2.33em; margin-block-end: 2.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},span:{proto:o(()=>HTMLSpanElement,"proto")},pre:{proto:o(()=>HTMLElement,"proto"),style:"display: block; font-family: monospace; white-space: pre; margin: 1em 0; --marp-auto-scaling-white-space: pre;"}},A="data-marp-auto-scaling-wrapper",p="data-marp-auto-scaling-svg",c="data-marp-auto-scaling-container",T=class T extends HTMLElement{constructor(){super();v(this,"container");v(this,"containerSize");v(this,"containerObserver");v(this,"svg");v(this,"svgComputedStyle");v(this,"svgPreserveAspectRatio","xMinYMid meet");v(this,"wrapper");v(this,"wrapperSize");v(this,"wrapperObserver");const s=o(t=>([e])=>{const{width:n,height:r}=e.contentRect;this[t]={width:n,height:r},this.updateSVGRect()},"e");this.attachShadow({mode:"open"}),this.containerObserver=new ResizeObserver(s("containerSize")),this.wrapperObserver=new ResizeObserver((...t)=>{s("wrapperSize")(...t),this.flushSvgDisplay()})}static get observedAttributes(){return["data-downscale-only"]}connectedCallback(){this.shadowRoot.innerHTML=`
<style>
  svg[${p}] { display: block; width: 100%; height: auto; vertical-align: top; }
  span[${c}] { display: table; white-space: var(--marp-auto-scaling-white-space, nowrap); width: max-content; }
</style>
<div ${A}>
  <svg part="svg" ${p}>
    <foreignObject><span ${c}><slot></slot></span></foreignObject>
  </svg>
</div>
    `.split(/\n\s*/).join(""),this.wrapper=this.shadowRoot.querySelector(`div[${A}]`)??void 0;const s=this.svg;this.svg=this.wrapper?.querySelector(`svg[${p}]`)??void 0,this.svg!==s&&(this.svgComputedStyle=this.svg?window.getComputedStyle(this.svg):void 0),this.container=this.svg?.querySelector(`span[${c}]`)??void 0,this.observe()}disconnectedCallback(){this.svg=void 0,this.svgComputedStyle=void 0,this.wrapper=void 0,this.container=void 0,this.observe()}attributeChangedCallback(){this.observe()}flushSvgDisplay(){const{svg:s}=this;s&&(s.style.display="inline",requestAnimationFrame(()=>{s.style.display=""}))}observe(){this.containerObserver.disconnect(),this.wrapperObserver.disconnect(),this.wrapper&&this.wrapperObserver.observe(this.wrapper),this.container&&this.containerObserver.observe(this.container),this.svgComputedStyle&&this.observeSVGStyle(this.svgComputedStyle)}observeSVGStyle(s){const t=o(()=>{const e=(()=>{const n=s.getPropertyValue("--preserve-aspect-ratio");return n?n.trim():`x${(({textAlign:r,direction:l})=>{if(r.endsWith("left"))return"Min";if(r.endsWith("right"))return"Max";if(r==="start"||r==="end"){let d=l==="rtl";return r==="end"&&(d=!d),d?"Max":"Min"}return"Mid"})(s)}YMid meet`})();e!==this.svgPreserveAspectRatio&&(this.svgPreserveAspectRatio=e,this.updateSVGRect()),s===this.svgComputedStyle&&requestAnimationFrame(t)},"t");t()}updateSVGRect(){let s=Math.ceil(this.containerSize?.width??0);const t=Math.ceil(this.containerSize?.height??0);this.dataset.downscaleOnly!==void 0&&(s=Math.max(s,this.wrapperSize?.width??0));const e=this.svg?.querySelector(":scope > foreignObject");if(e?.setAttribute("width",`${s}`),e?.setAttribute("height",`${t}`),this.svg&&(this.svg.setAttribute("viewBox",`0 0 ${s} ${t}`),this.svg.setAttribute("preserveAspectRatio",this.svgPreserveAspectRatio),this.svg.style.height=s<=0||t<=0?"0":""),this.container){const n=this.svgPreserveAspectRatio.toLowerCase();this.container.style.marginLeft=n.startsWith("xmid")||n.startsWith("xmax")?"auto":"0",this.container.style.marginRight=n.startsWith("xmi")?"auto":"0"}}};o(T,"s");let i=T;const m=o((a,{attrs:u={},style:s})=>class extends a{constructor(...t){super(...t);for(const[e,n]of Object.entries(u))this.hasAttribute(e)||this.setAttribute(e,n);this._shadow()}static get observedAttributes(){return["data-auto-scaling"]}connectedCallback(){this._update()}attributeChangedCallback(){this._update()}_shadow(){if(!this.shadowRoot)try{this.attachShadow({mode:"open"})}catch(t){if(!(t instanceof Error&&t.name==="NotSupportedError"))throw t}return this.shadowRoot}_update(){const t=this._shadow();if(t){const e=s?`<style>:host { ${s} }</style>`:"";let n="<slot></slot>";const{autoScaling:r}=this.dataset;r!==void 0&&(n=`<marp-auto-scaling exportparts="svg:auto-scaling" ${r==="downscale-only"?"data-downscale-only":""}>${n}</marp-auto-scaling>`),t.innerHTML=e+n}}},"r");let b;const z=Symbol();let $;const V="marpitSVGPolyfill:setZoomFactor,",C=Symbol(),j=Symbol(),G=o(()=>{const a=navigator.vendor==="Apple Computer, Inc.",u=a?[D]:[],s={then:o(t=>(a?(async()=>{if($===void 0){const e=document.createElement("canvas");e.width=10,e.height=10;const n=e.getContext("2d"),r=new Image(10,10),l=new Promise(d=>{r.addEventListener("load",()=>d())});r.crossOrigin="anonymous",r.src="data:image/svg+xml;charset=utf8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2210%22%20height%3D%2210%22%20viewBox%3D%220%200%201%201%22%3E%3CforeignObject%20width%3D%221%22%20height%3D%221%22%20requiredExtensions%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22width%3A%201px%3B%20height%3A%201px%3B%20background%3A%20red%3B%20position%3A%20relative%22%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3C%2Fsvg%3E",await l,n.drawImage(r,0,0),$=n.getImageData(5,5,1,1).data[3]<128}return $})().then(e=>{t?.(e?[D]:[])}):t?.([]),s),"then")};return Object.assign(u,s)},"g");let H,O;function D(a){const u=typeof a=="object"&&a.target||document,s=typeof a=="object"?a.zoom:a;window[j]||(Object.defineProperty(window,j,{configurable:!0,value:!0}),document.body.style.zoom=1.0001,document.body.offsetHeight,document.body.style.zoom=1,window.addEventListener("message",({data:e,origin:n})=>{if(n===window.origin)try{if(e&&typeof e=="string"&&e.startsWith(V)){const[,r]=e.split(","),l=Number.parseFloat(r);Number.isNaN(l)||(O=l)}}catch(r){console.error(r)}}));let t=!1;Array.from(u.querySelectorAll("svg[data-marpit-svg]"),e=>{var n,r,l,d;e.style.transform||(e.style.transform="translateZ(0)");const f=s||O||e.currentScale||1;H!==f&&(H=f,t=f);const P=e.getBoundingClientRect(),{length:Z}=e.children;for(let F=0;F<Z;F+=1){const k=e.children[F];if(k.getScreenCTM){const _=k.getScreenCTM();if(_){const Y=(r=(n=k.x)===null||n===void 0?void 0:n.baseVal.value)!==null&&r!==void 0?r:0,U=(d=(l=k.y)===null||l===void 0?void 0:l.baseVal.value)!==null&&d!==void 0?d:0,J=k.children.length;for(let R=0;R<J;R+=1){const N=k.children[R];if(N.tagName==="SECTION"){const{style:q}=N;q.transformOrigin||(q.transformOrigin=`${-Y}px ${-U}px`),q.transform=`scale(${f}) matrix(${_.a}, ${_.b}, ${_.c}, ${_.d}, ${_.e-P.left}, ${_.f-P.top}) translateZ(0.0001px)`;break}}}}}}),t!==!1&&Array.from(u.querySelectorAll("iframe"),({contentWindow:e})=>{e?.postMessage(`${V}${t}`,window.origin==="null"?"*":window.origin)})}o(D,"u");function B({once:a=!1,target:u=document}={}){const s=function(t=document){if(t[C])return t[C];let e=!0;const n=o(()=>{e=!1,delete t[C]},"i");Object.defineProperty(t,C,{configurable:!0,value:n});let r=[],l=!1;(async()=>{try{r=await G()}finally{l=!0}})();const d=o(()=>{for(const f of r)f({target:t});l&&r.length===0||e&&window.requestAnimationFrame(d)},"r");return d(),n}(u);return a?(s(),()=>{}):s}o(B,"v"),H=1,O=void 0;const I=B,M=Symbol(),L=o((a=document)=>{if(typeof window>"u")throw new Error("Marp Core's browser script is valid only in browser context.");if(((e=document)=>{const n=window[z];n||customElements.define("marp-auto-scaling",i);for(const r of Object.keys(E)){const l=`marp-${r}`,d=E[r].proto();(b??(b=!!document.createElement("div",{is:"marp-auto-scaling"}).outerHTML.startsWith("<div is"),b))&&d!==HTMLElement?n||customElements.define(l,m(d,{style:E[r].style}),{extends:r}):(n||customElements.define(l,m(HTMLElement,E[r])),e.querySelectorAll(`${r}[is="${l}"]`).forEach(f=>{f.outerHTML=f.outerHTML.replace(new RegExp(`^<${r}`,"i"),`<${l}`).replace(new RegExp(`</${r}>$`,"i"),`</${l}>`)}))}window[z]=!0})(a),a[M])return a[M];const u=B({target:a}),s=o(()=>{u(),delete a[M]},"n"),t=Object.assign(s,{cleanup:s,update:o(()=>L(a),"update")});return Object.defineProperty(a,M,{configurable:!0,value:t}),t},"y");S.browser=L,g=L,g=I}},h={};function x(y){var S=h[y];if(S!==void 0)return S.exports;var g=h[y]={exports:{}};return w[y](g,g.exports,x),g.exports}o(x,"__webpack_require__");var Q={};(()=>{"use strict";var y=x(32);function S(){let p,c;const i=o(()=>{const m=document.getElementById("__marp-vscode"),b=!!m;p!==b?(document.body.classList.toggle("marp-vscode",b),b?c=(0,y.browser)():(c?.cleanup(),c=void 0),p=b):b&&c?.update(),p?(m&&g(m),E()):A()},"updateCallback");window.addEventListener("load",()=>window.setTimeout(i,100)),window.addEventListener("vscode.markdown.updateContent",i),i()}o(S,"preview");const g=o(p=>{p.querySelectorAll("[is]").forEach(c=>{if(c.nodeName.includes("-")||document.createElement(c.nodeName).constructor!==c.constructor)return;const{outerHTML:m}=c;c.outerHTML=m,console.debug("[marp-vscode] Custom element has been upgraded forcibly:",m.slice(0,m.indexOf(">")+1||void 0))})},"forceUpgradeCustomElements"),E=o(()=>{const p=document.querySelectorAll("style:not(#__marp-vscode-style,#_defaultStyles,[data-marp-vscode-body])"),c=document.querySelectorAll('link[rel="stylesheet"][href]:not([href*="marp-vscode"])');p.forEach(i=>{i.closest("#__marp-vscode")||(i.dataset.marpVscodeBody=i.textContent??"",i.textContent="")}),c.forEach(i=>{if(i.closest("#__marp-vscode"))return;const{href:m}=i;i.dataset.marpVscodeHref=m,i.removeAttribute("href")})},"removeStyles"),A=o(()=>{const p=document.querySelectorAll("style[data-marp-vscode-body]"),c=document.querySelectorAll("link[data-marp-vscode-href]");p.forEach(i=>{i.textContent=i.dataset.marpVscodeBody||"",delete i.dataset.marpVscodeBody}),c.forEach(i=>{i.href=i.dataset.marpVscodeHref||"",delete i.dataset.marpVscodeHref})},"restoreStyles");S()})()})();})();

</script>

        </body>
        </html>